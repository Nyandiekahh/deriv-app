"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7884],{108340:(e,s,t)=>{t.d(s,{A:()=>c});var r=t(286326),i=t(261942),a=t(93219);const n=["mutate","mutateAsync"];function o(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,r)}return t}function l(e,s,t){return(s=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,s||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const c=(e,s)=>{const{send:t}=(0,a.A)(),c=(0,i.n)((s=>{const r=null==s?void 0:s[0],i=r&&"payload"in r?r.payload:void 0;return t(e,i)}),s),{mutate:u,mutateAsync:d}=c,p=function(e,s){if(null==e)return{};var t,r,i=function(e,s){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==s.indexOf(r))continue;t[r]=e[r]}return t}(e,s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],-1===s.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}(c,n);return function(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?o(Object(t),!0).forEach((function(s){l(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}({mutate:(0,r.useCallback)(((...e)=>u(e)),[u]),mutateAsync:(0,r.useCallback)(((...e)=>d(e)),[d])},p)}},499399:(e,s,t)=>{t.r(s),t.d(s,{default:()=>O});var r=t(286326),i=t(592353),a=t(391289),n=t(500309),o=t(414646),l=t(255530),c=t.n(l),u=t(824223),d=t(828112),p=t(504377),_=t(33118),m=t(836870);const h=()=>(0,m.jsxs)("div",{className:"link-expired__spaced-container__content link-expired__spaced-container__email_sent",children:[(0,m.jsx)(i.Icon,{data_testid:"dt_email-resent",icon:"IcEmailVerificationResent",size:128}),(0,m.jsx)(i.Text,{as:"p",size:"s",align:"center",children:(0,m.jsx)(_.Localize,{i18n_default_text:"<0>We've sent you an email.</0>",components:[(0,m.jsx)("strong",{},0)]})}),(0,m.jsx)(i.Text,{as:"p",size:"s",align:"center",children:(0,m.jsx)(_.Localize,{i18n_default_text:"Please click on the link in the email to reset your password."})})]}),g=(0,n.observer)((()=>{const{ui:e,client:s}=(0,o.A)(),{setPreventRedirectToHub:t}=s,{enableApp:a,disableApp:n,is_link_expired_modal_visible:l,toggleLinkExpiredModal:g}=e,{send:b,error:w,data:f}=(0,d.A)("reset_password"),[v,x]=r.useState(!1),j=(0,u.useFormik)({initialValues:{email:""},initialStatus:{error_msg:""},validate:e=>(0,p.validEmail)(e.email)?{}:{email:(0,p.getErrorMessages)().email()},onSubmit:e=>b(e.email)}),{errors:y,handleBlur:k,handleChange:O,handleSubmit:S,isSubmitting:P,resetForm:C,setStatus:R,setSubmitting:z,status:E,touched:A,values:N}=j;return r.useEffect((()=>{f&&(z(!1),x(!0))}),[f,z]),r.useEffect((()=>{w&&"object"==typeof w&&"message"in w&&(C(),R({error_msg:null==w?void 0:w.message}))}),[w,C,R]),(0,m.jsx)("form",{onSubmit:S,children:(0,m.jsx)(i.Dialog,{className:c()("link-expired__spaced-container",{"link-expired__spaced-container__fullscreen":v}),is_visible:l,disableApp:n,enableApp:a,title:v?"":(0,_.localize)("Link expired"),has_close_icon:!0,onConfirm:()=>{g(!1),t(!1)},children:(0,m.jsx)("div",{className:"link-expired",children:v?(0,m.jsx)(h,{}):(0,m.jsxs)("div",{className:"link-expired__spaced-container__content",children:[(0,m.jsx)(i.Text,{as:"p",size:"xs",align:"left",children:(0,m.jsx)(_.Localize,{i18n_default_text:"The link you clicked has expired. Ensure to click the link in the latest email in your inbox. Alternatively, enter your email below and click <0>Resend email</0> for a new link.",components:[(0,m.jsx)("strong",{},0)]})}),(0,m.jsx)("fieldset",{className:"email-platform__content__fieldset",children:(0,m.jsx)(i.Input,{className:"email-input","data-lpignore":"true",type:"text",name:"email",id:"email",onChange:e=>{R({error_msg:""}),O(e)},disabled:P,onBlur:k,error:A.email&&y.email||E.error_msg,label:(0,_.localize)("Email address"),value:N.email})}),(0,m.jsx)(i.FormSubmitButton,{has_cancel:!0,cancel_label:(0,_.localize)("Close"),onCancel:()=>{g(!1),t(!1)},is_disabled:!N.email||!!y.email||P,is_loading:P,label:(0,_.localize)("Resend email")})]})})})})}));var b=t(351185),w=t(919796),f=t(160756);const v=(0,n.observer)((()=>{const{ui:e,client:s}=(0,o.A)(),{logout:t,verification_code:r,setVerificationCode:a,setPreventRedirectToHub:n}=s,l=/deriv\.(com)/.test(window.location.hostname)||/localhost:8443/.test(window.location.host),{disableApp:d,enableApp:h,is_loading:g,is_reset_password_modal_visible:v,toggleResetPasswordModal:x,toggleLinkExpiredModal:j}=e,{isTmbEnabled:y}=(0,f.A)(),{isDesktop:k}=(0,w.Y)(),O=async(e,s)=>{const r=await y();s.setSubmitting(!1);const i=null==e?void 0:e.code;i?"InvalidToken"===i?(x(!1),j(!0)):(s.resetForm({values:{password:""}}),s.setStatus({error_msg:null==e?void 0:e.message})):(n(!1),s.setStatus({reset_complete:!0}),t().then((()=>{if(l&&!r)try{(0,b.ZF)({redirectCallbackUri:`${window.location.origin}/callback`}).catch((e=>{console.error(e)}))}catch(e){console.error(e)}else(0,p.redirectToLogin)(!1,(0,_.getLanguage)())})))},S=()=>{n(!1),x(!1),(0,p.removeActionParam)("reset_password")};return(0,m.jsx)(u.Formik,{initialValues:{password:""},initialStatus:{reset_complete:!1,error_msg:""},validate:e=>{const s={};return(0,p.validLength)(e.password,{min:8,max:25})?(0,p.validPassword)(e.password)||(s.password=(0,p.getErrorMessages)().password()):s.password=(0,_.localize)("You should enter {{min_number}}-{{max_number}} characters.",{min_number:8,max_number:25}),s},onSubmit:(e,s)=>{const t={reset_password:1,new_password:e.password,verification_code:r.reset_password};p.WS.resetPassword(t).then((async e=>{e.error?O(null==e?void 0:e.error,s):O(null,s),a("","reset_password")}))},children:({handleBlur:e,errors:s,values:t,touched:r,isSubmitting:a,handleChange:n,status:o})=>(0,m.jsx)(i.Dialog,{className:"reset-password__spaced-container",is_visible:v,disableApp:d,enableApp:h,is_loading:g,dismissable:o.error_msg,onConfirm:S,title:(0,_.localize)("Reset your password"),has_close_icon:!0,is_closed_on_cancel:!1,children:(0,m.jsx)("div",{className:"reset-password",children:(0,m.jsx)(u.Form,{children:o.reset_complete?(0,m.jsxs)("div",{className:"reset-password__password-set",children:[(0,m.jsx)(i.Text,{align:"center",as:"p",weight:"bold",className:"reset-password__heading",children:(0,m.jsx)(_.Localize,{i18n_default_text:"Your password has been changed"})}),(0,m.jsx)(i.Text,{align:"center",as:"p",size:"xxs",className:"reset-password__subtext",children:(0,m.jsx)(_.Localize,{i18n_default_text:"We will now redirect you to the login page."})})]}):(0,m.jsxs)("div",{className:"reset-password__password-selection",children:[(0,m.jsx)("fieldset",{className:"reset-password__fieldset",children:(0,m.jsx)(i.PasswordMeter,{input:t.password,has_error:!!(r.password&&s.password||o.error_msg),custom_feedback_messages:(0,p.getErrorMessages)().password_warnings,children:(0,m.jsx)(i.PasswordInput,{autoComplete:"new-password",className:"reset-password__password-field",name:"password",label:(0,_.localize)("Create a password"),onChange:n,onBlur:e,error:r.password&&s.password||o.error_msg,value:t.password,"data-lpignore":"true",required:!0})})}),(0,m.jsx)(i.Text,{align:"center",as:"p",size:"xxs",className:"reset-password__subtext",children:o.error_msg?(0,m.jsx)(_.Localize,{i18n_default_text:"{{error_msg}}",values:{error_msg:o.error_msg}}):(0,m.jsx)(_.Localize,{i18n_default_text:"Strong passwords contain at least 8 characters. combine uppercase and lowercase letters, numbers, and symbols."})}),k&&(0,m.jsx)("div",{className:"reset-password__divider"}),(0,m.jsx)(i.Button,{className:c()("reset-password__btn",{"reset-password__btn--disabled":!t.password||s.password||a}),type:"submit",is_disabled:!t.password||!!s.password||a,primary:!0,children:(0,m.jsx)(_.Localize,{i18n_default_text:"Reset my password"})})]})})})})})}));var x=t(158965);function j(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,r)}return t}function y(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?j(Object(t),!0).forEach((function(s){k(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}function k(e,s,t){return(s=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,s||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const O=(0,n.observer)((()=>{const{client:e,ui:s}=(0,o.A)(),{is_logged_in:t}=e,{is_link_expired_modal_visible:n}=s,[l,c]=r.useReducer(((e,s)=>y(y({},e),s)),{is_loading:!0,is_unlinking:!1});return r.useEffect((()=>{!async function(){if(t){var e;const s=await a.WS.wait("get_account_status");null!=s&&null!==(e=s.get_account_status)&&void 0!==e&&e.social_identity_provider?c({is_unlinking:!0,is_loading:!1}):c({is_unlinking:!1,is_loading:!1})}else c({is_unlinking:!1,is_loading:!1})}()}),[t]),l.is_loading?(0,m.jsx)(i.Loading,{is_fullscreen:!1}):l.is_unlinking?(0,m.jsx)(x.default,{}):n?(0,m.jsx)(g,{}):(0,m.jsx)(v,{})}))},158965:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var r=t(286326),i=t(597598),a=t.n(i),n=t(255530),o=t.n(n),l=t(824223),c=t(592353),u=t(504377),d=t(33118),p=t(391289),_=t(500309),m=t(414646),h=t(836870);const g=({logoutClient:e,social_identity_provider:s,toggleResetPasswordModal:t,verification_code:i,new_email:a})=>{const n=(0,u.getActionFromUrl)(),_=(e,s)=>{if(s.setSubmitting(!1),s.resetForm({password:""}),e)return console.error(e),void s.setStatus({error_msg:e});s.setStatus({reset_complete:!0})},m=(e,s)=>{e.error?_(e.error.message,s):_(null,s)};return(0,h.jsx)("div",{className:"unlink-password",children:(0,h.jsx)(l.Formik,{initialValues:{password:""},initialStatus:{reset_complete:!1,error_msg:""},validate:e=>{const s={};return(0,u.validLength)(e.password,{min:8,max:25})?(0,u.validPassword)(e.password)||(s.password=(0,u.getErrorMessages)().password()):s.password=(0,d.localize)("You should enter {{min_number}}-{{max_number}} characters.",{min_number:8,max_number:25}),s},onSubmit:(e,s)=>{if("social_email_change"===n){const t={change_email:"update",new_email:a,new_password:e.password,verification_code:i};p.WS.changeEmail(t).then((async e=>{m(e,s)}))}else{const t={reset_password:1,new_password:e.password,verification_code:i};p.WS.resetPassword(t).then((async e=>{m(e,s)}))}(0,u.removeActionParam)("social_email_change")},children:({handleBlur:i,errors:a,values:n,touched:p,isSubmitting:_,handleChange:m,status:g})=>(0,h.jsx)(l.Form,{children:(0,h.jsx)(r.Fragment,{children:g.reset_complete?(0,h.jsxs)("div",{className:"unlink-password__password-success",children:[(0,h.jsx)(c.Icon,{className:"unlink-password__icon",icon:`IcUnlink${(0,u.toTitleCase)(s)}`,size:128}),(0,h.jsx)(c.Text,{as:"p",weight:"bold",className:"unlink-password__heading",children:(0,h.jsx)(d.Localize,{i18n_default_text:"Success!"})}),(0,h.jsx)(c.Text,{align:"center",as:"p",size:"xs",className:"unlink-password__subtext",children:(0,h.jsx)(d.Localize,{i18n_default_text:"Your Deriv account has been unlinked from your {{social_identity_provider}} account. You can now log in to Deriv using your new email address and password.",values:{social_identity_provider:(0,u.toTitleCase)(s)}})}),(0,h.jsx)(c.Button,{type:"button",onClick:()=>{t(!1),e().then((()=>{(0,u.redirectToLogin)(!1,(0,d.getLanguage)(),!1)}))},primary:!0,large:!0,children:(0,h.jsx)(d.Localize,{i18n_default_text:"Login now"})})]}):(0,h.jsxs)("div",{className:"unlink-password__set-password",children:[(0,h.jsx)(c.Text,{as:"p",weight:"bold",className:"unlink-password__heading",children:(0,h.jsx)(d.Localize,{i18n_default_text:"Deriv password"})}),(0,h.jsx)(c.Text,{as:"p",size:"xs",className:"unlink-password__subtext",children:(0,h.jsx)(d.Localize,{i18n_default_text:"Enter a new password for your Deriv account."})}),(0,h.jsx)("fieldset",{className:"unlink-password__input-field",children:(0,h.jsx)(c.PasswordMeter,{input:n.password,has_error:!(!p.password||!a.password),custom_feedback_messages:(0,u.getErrorMessages)().password_warnings,children:(0,h.jsx)(c.PasswordInput,{autoComplete:"new-password",className:"unlink-password__password-field",name:"password",label:(0,d.localize)("Deriv password"),onChange:m,onBlur:i,error:p.password&&a.password,value:n.password,"data-lpignore":"true",required:!0})})}),(0,h.jsx)(c.Text,{as:"p",size:"xs",className:"unlink-password__hint",children:g.error_msg?(0,d.localize)(g.error_msg):(0,h.jsx)(d.Localize,{i18n_default_text:"Strong passwords contain at least 8 characters, combine uppercase and lowercase letters, numbers, and symbols."})}),(0,h.jsx)(c.Button,{className:o()("unlink-password__btn",{"unlink-password__btn--disabled":!n.password||a.password||_}),type:"submit",is_disabled:!n.password||!!a.password||_,primary:!0,large:!0,children:(0,h.jsx)(d.Localize,{i18n_default_text:"Confirm"})})]})})})})})};g.propTypes={logoutClient:a().func,toggleResetPasswordModal:a().func,verification_code:a().string,social_identity_provider:a().string};const b=(0,_.observer)((()=>{const{ui:e,client:s}=(0,m.A)(),{logout:t,social_identity_provider:r,verification_code:i}=s,{disableApp:a,enableApp:n,is_loading:o,is_reset_password_modal_visible:l,toggleResetPasswordModal:u}=e,d=i.reset_password,p=i.social_email_change,_=s.new_email.social_email_change;return(0,h.jsx)(c.Dialog,{className:"unlink-password__dialog",is_visible:l,disableApp:a,enableApp:n,is_loading:o,children:(0,h.jsx)(g,{logoutClient:t,social_identity_provider:r,toggleResetPasswordModal:u,verification_code:p||d,new_email:_})})}))},161808:(e,s,t)=>{t.d(s,{A:()=>i});var r=t(286326);const i=({from:e,to:s=0,increment:t=!1})=>{const[i,a]=(0,r.useState)(e),[n,o]=(0,r.useState)(!1);(0,r.useEffect)((()=>{let e;return n&&(e=setTimeout((()=>{i===s?l():a((e=>t?e+1:e-1))}),1e3)),()=>clearTimeout(e)}),[i,n,s,t]);const l=()=>o(!1),c=()=>a(e);return{count:i,is_running:n,start:()=>o(!0),pause:l,reset:c,stop:()=>{l(),c()}}}},828112:(e,s,t)=>{t.d(s,{A:()=>o});var r=t(286326),i=t(108340),a=t(414646),n=t(161808);const o=e=>{const s=(0,i.A)("verify_email"),t=(0,n.A)({from:60}),{client:o}=(0,a.A)(),[l,c]=(0,r.useState)(0),u=(0,r.useCallback)((r=>{const i=null!=r?r:o.email;i&&(t.is_running||(t.reset(),t.start(),c((e=>e+1)),s.mutate({payload:{verify_email:i,type:e}})))}),[s,o.email,t,e]),d=(0,r.useCallback)((()=>{s.mutate({payload:{verify_email:o.email,type:e}})}),[s,o.email,e]);return{WS:s,is_loading:s.isLoading,error:s.error,data:s.data,counter:t.count,is_counter_running:t.is_running,sent_count:l,has_been_sent:0!==l,send:u,sendPhoneNumberVerifyEmail:d}}},261942:(e,s,t)=>{t.d(s,{n:()=>p});var r=t(286326),i=t(435139),a=t(217293),n=t(393012),o=t(558375);class l extends o.Q{constructor(e,s){super(),this.client=e,this.setOptions(s),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;const t=this.options;this.options=this.client.defaultMutationOptions(e),(0,i.f8)(t,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),null==(s=this.currentMutation)||s.setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(null==(e=this.currentMutation)||e.removeObserver(this))}onMutationUpdate(e){this.updateResult();const s={listeners:!0};"success"===e.type?s.onSuccess=!0:"error"===e.type&&(s.onError=!0),this.notify(s)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(e,s){return this.mutateOptions=s,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:void 0!==e?e:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const e=this.currentMutation?this.currentMutation.state:(0,a.$)(),s={...e,isLoading:"loading"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset};this.currentResult=s}notify(e){n.j.batch((()=>{var s,t,r,i;if(this.mutateOptions&&this.hasListeners())if(e.onSuccess)null==(s=(t=this.mutateOptions).onSuccess)||s.call(t,this.currentResult.data,this.currentResult.variables,this.currentResult.context),null==(r=(i=this.mutateOptions).onSettled)||r.call(i,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context);else if(e.onError){var a,n,o,l;null==(a=(n=this.mutateOptions).onError)||a.call(n,this.currentResult.error,this.currentResult.variables,this.currentResult.context),null==(o=(l=this.mutateOptions).onSettled)||o.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}e.listeners&&this.listeners.forEach((({listener:e})=>{e(this.currentResult)}))}))}}var c=t(327478),u=t(348932),d=t(225061);function p(e,s,t){const a=(0,i.GR)(e,s,t),o=(0,u.jE)({context:a.context}),[p]=r.useState((()=>new l(o,a)));r.useEffect((()=>{p.setOptions(a)}),[p,a]);const m=(0,c.r)(r.useCallback((e=>p.subscribe(n.j.batchCalls(e))),[p]),(()=>p.getCurrentResult()),(()=>p.getCurrentResult())),h=r.useCallback(((e,s)=>{p.mutate(e,s).catch(_)}),[p]);if(m.error&&(0,d.G)(p.options.useErrorBoundary,[m.error]))throw m.error;return{...m,mutate:h,mutateAsync:m.mutate}}function _(){}}}]);
//# sourceMappingURL=core.chunk.reset-or-unlink-password-modal.78973846415b1162ad96.js.map