/*! For license information please see core.3020.78973846415b1162ad96.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[3020],{205410:(e,t,r)=>{var n,o;!function(a){if(void 0===(o="function"==typeof(n=a)?n.call(t,r,t,e):n)||(e.exports=o),e.exports=a(),!!0){var i=window.Cookies,s=window.Cookies=a();s.noConflict=function(){return window.Cookies=i,s}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function o(){}function a(t,r,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},o.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var i=JSON.stringify(r);/^[\{\[]/.test(i)&&(r=i)}catch(e){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in a)a[c]&&(s+="; "+c,!0!==a[c]&&(s+="="+a[c].split(";")[0]));return document.cookie=t+"="+r+s}}function i(e,r){if("undefined"!=typeof document){for(var o={},a=document.cookie?document.cookie.split("; "):[],i=0;i<a.length;i++){var s=a[i].split("="),c=s.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(n.read||n)(c,l)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=a,o.get=function(e){return i(e,!1)},o.getJSON=function(e){return i(e,!0)},o.remove=function(t,r){a(t,"",e(r,{expires:-1}))},o.defaults={},o.withConverter=r,o}((function(){}))}))},77107:(e,t,r)=>{"use strict";r.d(t,{Mp:()=>R});var n=r(286326),o=r(294035);const a={[o.Zh.derivP2pProduction]:"blue.derivws.com",[o.Zh.derivP2pStaging]:"red.derivws.com"},i=()=>{const e=window.location.origin,t=window.location.hostname,{getAppId:r}=o.Zo,n=r(),i=o.Sp.getValue(o.ql.configAppId),s=o.Sp.getValue(o.ql.configServerURL);e===o.Zh.derivP2pStaging&&(!i||!s)&&(o.Sp.setValue(o.ql.configServerURL,a[e]),o.Sp.setValue(o.ql.configAppId,`${o.AO.domainAppId[t]}`));const c=o.Sp.getValue(o.ql.configServerURL)||localStorage.getItem("config.server_url");let l="oauth.deriv.com";c&&/qa/.test(String(c))?l=c:t.includes(".deriv.me")?l="oauth.deriv.me":t.includes(".deriv.be")&&(l="oauth.deriv.be");return{appId:o.Sp.getValue(o.ql.configAppId)||n,lang:o.Sp.getValue(o.ql.i18nLanguage),serverUrl:l}};function s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}(function e(t,r){function n(e,n,o){if(!(typeof document>"u")){"number"==typeof(o=s({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var i in o)o[i]&&(a+="; "+i,!0!==o[i]&&(a+="="+o[i].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+a}}return Object.create({set:n,get:function(e){if(!(typeof document>"u"||arguments.length&&!e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var a=r[o].split("="),i=a.slice(1).join("=");try{var s=decodeURIComponent(a[0]);if(n[s]=t.read(i,s),e===s)break}catch{}}return e?n[e]:n}},remove:function(e,t){n(e,"",s({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,s({},this.attributes,t))},withConverter:function(t){return e(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})})({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});Object.defineProperty;Error;class c extends Error{}function l(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch{return atob(t)}}c.prototype.name="InvalidTokenError";var d,p,u,h={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},g=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(g||{});(u=g||(g={})).reset=function(){d=3,p=h},u.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");d=e},u.setLogger=function(e){p=e};var f=class e{constructor(e){this._name=e}debug(...t){d>=4&&p.debug(e._format(this._name,this._method),...t)}info(...t){d>=3&&p.info(e._format(this._name,this._method),...t)}warn(...t){d>=2&&p.warn(e._format(this._name,this._method),...t)}error(...t){d>=1&&p.error(e._format(this._name,this._method),...t)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(t,r){const n=new e(`${t}.${r}`);return n.debug("begin"),n}static _format(e,t){const r=`[${e}]`;return t?`${r} ${t}:`:r}static debug(t,...r){d>=4&&p.debug(e._format(t),...r)}static info(t,...r){d>=3&&p.info(e._format(t),...r)}static warn(t,...r){d>=2&&p.warn(e._format(t),...r)}static error(t,...r){d>=1&&p.error(e._format(t),...r)}};g.reset();var m=class{static decode(e){try{return function(e,t){if("string"!=typeof e)throw new c("Invalid token specified: must be a string");t||(t={});const r=!0===t.header?0:1,n=e.split(".")[r];if("string"!=typeof n)throw new c(`Invalid token specified: missing part #${r+1}`);let o;try{o=l(n)}catch(e){throw new c(`Invalid token specified: invalid base64 for part #${r+1} (${e.message})`)}try{return JSON.parse(o)}catch(e){throw new c(`Invalid token specified: invalid json for part #${r+1} (${e.message})`)}}(e)}catch(e){throw f.error("JwtUtils.decode",e),e}}static async generateSignedJwt(e,t,r){const n=`${w.encodeBase64Url((new TextEncoder).encode(JSON.stringify(e)))}.${w.encodeBase64Url((new TextEncoder).encode(JSON.stringify(t)))}`,o=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,(new TextEncoder).encode(n));return`${n}.${w.encodeBase64Url(new Uint8Array(o))}`}},_=e=>btoa([...new Uint8Array(e)].map((e=>String.fromCharCode(e))).join("")),y=class e{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(+t^e._randomWord()&15>>+t/4).toString(16))).replace(/-/g,"")}static generateCodeVerifier(){return e.generateUUIDv4()+e.generateUUIDv4()+e.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return _(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw f.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const r=(new TextEncoder).encode([e,t].join(":"));return _(r)}static async hash(e,t){const r=(new TextEncoder).encode(t),n=await crypto.subtle.digest(e,r);return new Uint8Array(n)}static async customCalculateJwkThumbprint(t){let r;switch(t.kty){case"RSA":r={e:t.e,kty:t.kty,n:t.n};break;case"EC":r={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":r={crv:t.crv,kty:t.kty,x:t.x};break;case"oct":r={crv:t.k,kty:t.kty};break;default:throw new Error("Unknown jwk type")}const n=await e.hash("SHA-256",JSON.stringify(r));return e.encodeBase64Url(n)}static async generateDPoPProof({url:t,accessToken:r,httpMethod:n,keyPair:o,nonce:a}){let i,s;const c={jti:window.crypto.randomUUID(),htm:n??"GET",htu:t,iat:Math.floor(Date.now()/1e3)};r&&(i=await e.hash("SHA-256",r),s=e.encodeBase64Url(i),c.ath=s),a&&(c.nonce=a);try{const e=await crypto.subtle.exportKey("jwk",o.publicKey),t={alg:"ES256",typ:"dpop+jwt",jwk:{crv:e.crv,kty:e.kty,x:e.x,y:e.y}};return await m.generateSignedJwt(t,c,o.privateKey)}catch(e){throw e instanceof TypeError?new Error(`Error exporting dpop public key: ${e.message}`):e}}static async generateDPoPJkt(t){try{const r=await crypto.subtle.exportKey("jwk",t.publicKey);return await e.customCalculateJwkThumbprint(r)}catch(e){throw e instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${e.message}`):e}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};y.encodeBase64Url=e=>_(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var w=y,v=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new f(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}async raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)await t(...e)}},S=class e extends v{constructor(){super(...arguments),this._logger=new f(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const t=this._expiration-e.getEpochTime();this._logger.debug("timer completes in",t),this._expiration<=e.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(t){const r=this._logger.create("init");t=Math.max(Math.floor(t),1);const n=e.getEpochTime()+t;if(this.expiration===n&&this._timerHandle)return void r.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),r.debug("using duration",t),this._expiration=n;const o=Math.min(t,5);this._timerHandle=setInterval(this._callback,1e3*o)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},k=(Error,Error,Error,class e{constructor(e){this.id=e.id||w.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=S.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new f("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(t){return f.createStatic("State","fromStorageString"),Promise.resolve(new e(JSON.parse(t)))}static async clearStaleState(t,r){const n=f.createStatic("State","clearStaleState"),o=S.getEpochTime()-r,a=await t.getAllKeys();n.debug("got keys",a);for(let r=0;r<a.length;r++){const i=a[r],s=await t.get(i);let c=!1;if(s)try{const t=await e.fromStorageString(s);n.debug("got item from key:",i,t.created),t.created<=o&&(c=!0)}catch(e){n.error("Error parsing state for key:",i,e),c=!0}else n.debug("no item in storage for key:",i),c=!0;c&&(n.debug("removed item for key:",i),t.remove(i))}}}),b=class e extends k{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(t){const r=!0===t.code_verifier?w.generateCodeVerifier():t.code_verifier||void 0,n=r?await w.generateCodeChallenge(r):void 0;return new e({...t,code_verifier:r,code_challenge:n})}toStorageString(){return new f("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(t){f.createStatic("SigninState","fromStorageString");const r=JSON.parse(t);return e.create(r)}},E=class e{constructor(e){this.url=e.url,this.state=e.state}static async create({url:t,authority:r,client_id:n,redirect_uri:o,response_type:a,scope:i,state_data:s,response_mode:c,request_type:l,client_secret:d,nonce:p,url_state:u,resource:h,skipUserInfo:g,extraQueryParams:f,extraTokenParams:m,disablePKCE:_,dpopJkt:y,omitScopeWhenRequesting:w,...v}){if(!t)throw this._logger.error("create: No url passed"),new Error("url");if(!n)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!o)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!a)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!i)throw this._logger.error("create: No scope passed"),new Error("scope");if(!r)throw this._logger.error("create: No authority passed"),new Error("authority");const S=await b.create({data:s,request_type:l,url_state:u,code_verifier:!_,client_id:n,authority:r,redirect_uri:o,response_mode:c,client_secret:d,scope:i,extraTokenParams:m,skipUserInfo:g}),k=new URL(t);k.searchParams.append("client_id",n),k.searchParams.append("redirect_uri",o),k.searchParams.append("response_type",a),w||k.searchParams.append("scope",i),p&&k.searchParams.append("nonce",p),y&&k.searchParams.append("dpop_jkt",y);let E=S.id;u&&(E=`${E};${u}`),k.searchParams.append("state",E),S.code_challenge&&(k.searchParams.append("code_challenge",S.code_challenge),k.searchParams.append("code_challenge_method","S256")),h&&(Array.isArray(h)?h:[h]).forEach((e=>k.searchParams.append("resource",e)));for(const[e,t]of Object.entries({response_mode:c,...v,...f}))null!=t&&k.searchParams.append(e,t.toString());return new e({url:k.href,state:S})}};E._logger=new f("SigninRequest");var x,U={exports:{}},C={};U.exports=function(){if(x)return C;x=1;var e=n,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function s(e,r,n){var s,c={},l=null,d=null;for(s in void 0!==n&&(l=""+n),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(d=r.ref),r)o.call(r,s)&&!i.hasOwnProperty(s)&&(c[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps)void 0===c[s]&&(c[s]=r[s]);return{$$typeof:t,type:e,key:l,ref:d,props:c,_owner:a.current}}return C.Fragment=r,C.jsx=s,C.jsxs=s,C}();U.exports;var I=Object.defineProperty,P=(e,t,r)=>((e,t,r)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r),A=(e=>(e.FailedFetchSessionsActive="FailedFetchSessionsActive",e.FailedFetchSessionsRefresh="FailedFetchSessionsRefresh",e.FailedFetchSessionsLogout="FailedFetchSessionsLogout",e))(A||{});class O extends Error{constructor(e,t){super(t),P(this,"type"),this.name=e,this.type=e}}const R=async()=>{const{serverUrl:e}=i();try{return await(await fetch(`https://${e}/oauth2/sessions/active`,{method:"GET",credentials:"include"})).json()}catch(e){throw console.error("unable to request sessions active: ",e),e instanceof Error?new O(A.FailedFetchSessionsActive,e.message):new O(A.FailedFetchSessionsActive,"unable to request sessions active")}}}}]);
//# sourceMappingURL=core.3020.78973846415b1162ad96.js.map