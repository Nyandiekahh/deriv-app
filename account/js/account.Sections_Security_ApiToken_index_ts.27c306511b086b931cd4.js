"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_ApiToken_index_ts"],{"./Components/article/index.ts":(e,s,t)=>{t.d(s,{A:()=>r});var a=t("react"),i=t("@deriv/components"),n=t("@deriv-com/translations"),o=t("../../../node_modules/clsx/dist/clsx.mjs"),l=t("../../../node_modules/react/jsx-runtime.js");const r=({title:e,descriptions:s,onClickLearnMore:t,className:r})=>{const c=s?.length>0,d=1===s?.length;return(0,l.jsxs)("article",{className:(0,o.A)("da-article",r),children:[(0,l.jsx)(i.Text,{as:"h4",color:"prominent",line_height:"m",size:"xs",weight:"bold",className:"da-article__header",children:e}),c&&(0,l.jsx)(a.Fragment,{children:d?(0,l.jsx)(i.Text,{as:"p",size:"xxs",line_height:"m",children:s[0]}):(0,l.jsx)("ul",{className:"da-article__list",children:s.map(((e,s)=>(0,l.jsx)("li",{children:(0,l.jsx)(i.Text,{size:"xxs",line_height:"xs",children:e})},s)))})}),t&&(0,l.jsxs)("div",{className:"da-article__learn-more",onClick:t,children:[(0,l.jsx)(i.Text,{size:"xxs",color:"loss-danger",line_height:"s",children:(0,l.jsx)(n.Localize,{i18n_default_text:"Learn more"})}),(0,l.jsx)(i.Icon,{icon:"IcChevronRight",className:"da-article__learn-more-icon",color:"red"})]})]})}},"./Sections/Security/ApiToken/index.ts":(e,s,t)=>{t.r(s),t.d(s,{default:()=>S});var a=t("react"),i=t("../../../node_modules/clsx/dist/clsx.mjs"),n=t("formik"),o=t("@deriv/components"),l=t("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),r=t("@deriv/shared"),c=t("@deriv/stores"),d=t("@deriv-com/translations"),_=t("./Components/article/index.ts"),x=t("../../../node_modules/react/jsx-runtime.js");const m=()=>(0,x.jsx)(_.A,{title:(0,x.jsx)(d.Localize,{i18n_default_text:"API token"}),descriptions:[(0,x.jsx)(d.Localize,{i18n_default_text:"To access your mobile apps and other third-party apps, you'll first need to generate an API token."},0)]}),p=({name:e,display_name:s,description:t,children:a})=>(0,x.jsx)(n.Field,{name:e,children:({field:i,form:{setFieldValue:n}})=>(0,x.jsx)(o.CompositeCheckbox,{...i,onChange:()=>n(e,!i.value),className:"api-token__checkbox",label:s,description:t,children:a})}),u=({message:e})=>(0,x.jsxs)("div",{className:"da-api-token__bullet-wrapper",children:[(0,x.jsx)("div",{className:"da-api-token__bullet"}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:e})]}),h=()=>(0,x.jsxs)(a.Fragment,{children:[(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Be careful who you share this token with. Anyone with this token can perform the following actions on your account behalf"})}),(0,x.jsxs)("div",{className:"da-api-token__bullet-container",children:[(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Add accounts"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Create or delete API tokens for trading and withdrawals"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Modify account settings"})})]})]}),j=({scopes:e,text_copy:s,info_message:t,success_message:i,popover_alignment:n="bottom"})=>{const[l,c,_]=(0,o.useCopyToClipboard)(),[m,p]=(0,a.useState)(!1),[u,j]=(0,a.useState)(!1),k=(0,r.useIsMounted)();let g,f;const y=e?.includes("Admin"),b=()=>{p(!1),c(s??""),j(!0),g=setTimeout((()=>{k()&&(j(!1),_(!1))}),1900),f=setTimeout((()=>{k()&&_(!1)}),2050)};return(0,a.useEffect)((()=>()=>{clearTimeout(g),clearTimeout(f)}),[g,f]),(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:m,small:!0,children:[(0,x.jsx)(o.Modal.Body,{children:(0,x.jsx)(h,{})}),(0,x.jsx)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:b,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"OK"})})})]}),(0,x.jsx)(o.Popover,{alignment:n,classNameBubble:"dc-clipboard__popover",message:l?i:t,is_open:u,zIndex:"9999",children:(0,x.jsx)(o.Icon,{icon:""+(l?"IcCheckmarkCircle":"IcClipboard"),custom_color:""+(l?"var(--status-success)":"var(--text-prominent)"),className:"dc-clipboard",size:14,data_testid:""+(l?"dt_token_copied_icon":"dt_copy_token_icon"),onClick:()=>{y?p(!0):b()},onMouseEnter:()=>{l||j(!0)},onMouseLeave:()=>{l||j(!1)}})})]})},k=(0,a.createContext)({api_tokens:[],deleteToken:()=>Promise.resolve()}),g=({token:e,popover_alignment:s="left"})=>{const{isDesktop:t}=(0,l.Y)(),{deleteToken:i}=(0,a.useContext)(k),[n,c]=(0,a.useState)(!1),[_,m]=(0,a.useState)(!1),[p,u]=(0,a.useState)(!1),h=(0,r.useIsMounted)();return(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:n,small:!0,children:[(0,x.jsxs)(o.Modal.Body,{children:[(0,x.jsx)(o.Text,{as:"h1",color:"prominent",weight:"bold",className:"da-api-token__modal-title",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete token"})}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Are you sure you want to delete this token?"})})]}),(0,x.jsxs)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:[(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:()=>c(!1),secondary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Cancel"})}),(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:async()=>{m(!0),await i(e.token??""),h()&&(m(!1),c(!1))},primary:!0,large:!0,is_loading:_,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Yes, delete"})})]})]}),(0,x.jsx)(o.Popover,{alignment:s,classNameBubble:"dc-clipboard__popover",message:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete this token"}),relative_render:!1,zIndex:"9999",is_open:p,children:(0,x.jsx)(o.Icon,{icon:"IcDelete",custom_color:"var(--text-prominent)",className:"dc-clipboard da-api-token__delete-icon",onClick:()=>{t&&u(!1),c(!0)},size:14,data_testid:"dt_token_delete_icon",onMouseEnter:()=>{!n&&t&&u(!0)},onMouseLeave:()=>{!n&&t&&u(!1)}})})]})},f=({className:e,children:s,should_bypass_text:t})=>t?(0,x.jsx)("td",{className:(0,i.A)("da-api-token__table-cell",e),children:s}):(0,x.jsx)("td",{className:(0,i.A)("da-api-token__table-cell",e),children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",children:s})}),y=({text:e})=>(0,x.jsx)("th",{className:"da-api-token__table-header",children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",weight:"bold",children:e})}),b=()=>(0,x.jsx)("div",{"data-testid":"dt_hidden_tokens",className:"da-api-token__pass-dot-container",children:Array.from(Array(15).keys()).map((e=>(0,x.jsx)("div",{className:"da-api-token__pass-dot"},e)))}),v=({token:e,scopes:s})=>{const[t,i]=(0,a.useState)(!1);return(0,x.jsxs)("div",{className:"da-api-token__clipboard-wrapper",children:[t?(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:e}):(0,x.jsx)(b,{}),(0,x.jsx)(j,{info_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy this token"}),success_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Token copied!"}),text_copy:e,scopes:s}),(0,x.jsx)(o.Popover,{alignment:"bottom",classNameBubble:"dc-clipboard__popover",message:t?(0,x.jsx)(d.Localize,{i18n_default_text:"Hide this token"}):(0,x.jsx)(d.Localize,{i18n_default_text:"Show this token"}),children:(0,x.jsx)(o.Icon,{icon:t?"IcPasswordEyeVisible":"IcPasswordEyeHide",className:"da-api-token__visibility-icon",onClick:()=>{i((e=>!e))},width:15,custom_color:"var(--text-prominent)",data_testid:"dt_toggle_visibility_icon"})})]})},z=({scopes:e})=>(0,x.jsx)("div",{className:"da-api-token__table-scopes-cell-block",children:e?.map((e=>(0,x.jsx)("div",{className:(0,i.A)("da-api-token__table-scope-cell",{"da-api-token__table-scope-cell-admin":"admin"===e.toLowerCase()}),children:e},e)))}),T=({token:e})=>(0,x.jsxs)("tr",{className:"da-api-token__table-cell-row",children:[(0,x.jsx)(f,{className:"da-api-token__table-cell--name",children:e.display_name}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(v,{token:e.token,scopes:e.formatted_scopes})}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(z,{scopes:e.formatted_scopes})}),(0,x.jsx)(f,{children:e.last_used}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(g,{token:e})})]}),N=()=>{const{api_tokens:e}=(0,a.useContext)(k),{isDesktop:s}=(0,l.Y)(),{localize:t}=(0,d.useTranslations)(),i=e=>{const s=e?.scopes?.map((e=>(e=>{switch(e){case"read":return t("Read");case"trade":return t("Trade");case"payments":return t("Payments");case"admin":return t("Admin");case"trading_information":return t("Trading information");default:return(e=>{const s=e.replace(/[-_]/g," ");return s[0].toUpperCase()+s.slice(1).toLowerCase()})(e)}})(e))),a=e?.last_used?(0,r.formatDate)(e.last_used,"DD/MM/YYYY"):t("Never");return{display_name:e.display_name,formatted_scopes:s??[],last_used:a,token:e.token}};return s?(0,x.jsxs)("table",{className:"da-api-token__table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{className:"da-api-token__table-header-row",children:[(0,x.jsx)(y,{text:t("Name")}),(0,x.jsx)(y,{text:t("Token")}),(0,x.jsx)(y,{text:t("Scopes")}),(0,x.jsx)(y,{text:t("Last used")}),(0,x.jsx)("th",{})]})}),(0,x.jsx)("tbody",{children:e?.map((e=>(0,x.jsx)(T,{token:i(e)},e?.token)))})]}):(0,x.jsx)(a.Fragment,{children:e?.map((e=>{const s=i(e);return(0,x.jsxs)("div",{className:"da-api-token__scope",children:[(0,x.jsx)("div",{className:"da-api-token__scope-item",children:(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Name"})}),(0,x.jsx)(o.Text,{className:"da-api-token__scope-item--name",as:"p",size:"s",color:"general",line_height:"m",children:s.display_name})]})}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Token"})}),(0,x.jsx)(v,{token:s.token,scopes:s.formatted_scopes})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Last Used"})}),(0,x.jsx)(o.Text,{as:"p",size:"s",color:"general",line_height:"m",children:s.last_used})]})]}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Scopes"})}),(0,x.jsx)(z,{scopes:s.formatted_scopes})]}),(0,x.jsx)("div",{children:(0,x.jsx)(g,{token:s})})]})]},s.token)}))})};var w=t("./Components/load-error-message/index.ts");const L=[{name:"read",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Read"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your account activity, settings, limits, balance sheets, trade purchase history, and more."})},{name:"trade",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trade"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to buy and sell contracts for you, renew your expired purchases, and top up your demo accounts."})},{name:"payments",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Payments"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to withdraw to payment agents and make inter-account transfers for you."})},{name:"trading_information",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trading information"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your trading history."})},{name:"admin",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Admin"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to open accounts for you, manage your settings and token usage, and more. "})}],C=2,A=32,I=/^[A-Za-z0-9\s_]+$/,M=({icon:e,message:s,font_size:t="xxxs",icon_size:a=24,title:i})=>(0,x.jsxs)("div",{className:"da-inline-full-width-note-with-icon",children:[e&&(0,x.jsx)("div",{children:(0,x.jsx)(o.Icon,{icon:e,size:a})}),(0,x.jsxs)(o.Text,{as:"p",size:t,line_height:"s",children:[i&&(0,x.jsxs)("strong",{children:[" ",i," "]}),s]})]}),S=(0,c.observer)((()=>{const{client:e}=(0,c.useStore)(),{is_switching:s}=e,t=(0,a.useRef)(s),{isDesktop:_}=(0,l.Y)(),{localize:u}=(0,d.useTranslations)(),[h,j]=(0,a.useReducer)(((e,s)=>({...e,...s})),{api_tokens:[],is_loading:!0,is_success:!1,error_message:"",show_delete:!1,is_delete_loading:!1,is_delete_success:!1}),g=(0,a.useRef)(),f=(0,a.useRef)();(0,a.useEffect)((()=>(v(),()=>{clearTimeout(g.current),clearTimeout(f.current)})),[]),(0,a.useEffect)((()=>{t.current!==s&&(t.current=s,v())}),[s]);const y=e=>Object.keys(e).filter((s=>"token_name"!==s&&Boolean(e[s]))),b=e=>{e.error?j({is_loading:!1,error_message:(0,r.getPropertyValue)(e,["error","message"])}):j({is_loading:!1,api_tokens:(0,r.getPropertyValue)(e,["api_token","tokens"])})},v=async()=>{j({is_loading:!0});const e=await r.WS.authorized.apiToken({api_token:1});b(e)},{api_tokens:z,is_loading:T,is_success:S,error_message:P}=h;if(T||s)return(0,x.jsx)(o.Loading,{is_fullscreen:!1,className:"account__initial-loader"});if(P)return(0,x.jsx)(w.A,{error_message:P});if(void 0===z)return null;const F={api_tokens:z,deleteToken:async e=>{j({is_delete_loading:!0});const s=await r.WS.authorized.apiToken({api_token:1,delete_token:e});b(s),j({is_delete_loading:!1,is_delete_success:!0}),f.current=setTimeout((()=>{j({is_delete_success:!1})}),500)}};return(0,x.jsx)(k.Provider,{value:F,children:(0,x.jsx)("section",{className:"da-api-token",children:(0,x.jsxs)("div",{className:"da-api-token__wrapper",children:[(0,x.jsxs)(o.ThemedScrollbars,{className:"da-api-token__scrollbars",is_bypassed:!_,children:[!_&&(0,x.jsx)(m,{}),(0,x.jsx)(n.Formik,{initialValues:{token_name:"",read:!1,trade:!1,payments:!1,trading_information:!1,admin:!1},onSubmit:async(e,{setSubmitting:s,setFieldError:t,resetForm:a})=>{const i=await r.WS.apiToken({api_token:1,new_token:e.token_name,new_token_scopes:y(e)});i.error?t("token_name",i.error.message):(j({is_success:!0,api_tokens:(0,r.getPropertyValue)(i,["api_token","tokens"])}),g.current=setTimeout((()=>{j({is_success:!1})}),500)),a(),s(!1)},validate:e=>{const s={},t=e?.token_name?.trim();return t?I.test(t)?t.length<C?s.token_name=u("Length of token name must be between {{MIN_TOKEN}} and {{MAX_TOKEN}} characters.",{MIN_TOKEN:C,MAX_TOKEN:A}):t.length>A&&(s.token_name=u("Maximum {{MAX_TOKEN}} characters.",{MAX_TOKEN:A})):s.token_name=u("Only letters, numbers, and underscores are allowed."):s.token_name=u("Please enter a token name."),s},children:({values:e,errors:s,isValid:t,dirty:a,touched:l,handleChange:r,handleBlur:c,isSubmitting:_,setFieldTouched:m})=>(0,x.jsxs)(n.Form,{noValidate:!0,children:[(0,x.jsx)(M,{icon:"IcAppstoreNewWarning",font_size:"xs",message:(0,x.jsx)(d.Localize,{i18n_default_text:"To avoid loss of funds, do not share tokens with <0>unauthorised</0> parties, especially the tokens with any of the following scopes: <0>Payments</0>, <0>Admin</0>, or <0>Trade</0>.",components:[(0,x.jsx)("strong",{},0)]})}),(0,x.jsxs)(o.Timeline,{className:"da-api-token__timeline",line_height:"xxxl",children:[(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Select scopes based on the access you need."}),children:(0,x.jsx)("div",{className:"da-api-token__checkbox-wrapper",children:L.map((e=>(0,x.jsx)(p,{name:e.name,display_name:e.display_name,description:e.description},e.name)))})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Name your token and click on 'Create' to generate your token."}),children:(0,x.jsxs)("div",{className:"da-api-token__input-group",children:[(0,x.jsx)(n.Field,{name:"token_name",children:({field:t})=>(0,x.jsx)(o.Input,{...t,"data-lpignore":"true",type:"text",className:"da-api-token__input dc-input__input-group",label:u("Token name"),value:e.token_name,onChange:e=>{m("token_name",!0),r(e)},onBlur:c,hint:(0,x.jsx)(d.Localize,{i18n_default_text:"Length of token name must be between 2 and 32 characters."}),required:!0,error:l.token_name&&s.token_name?s.token_name:void 0})}),(0,x.jsx)(o.Button,{className:(0,i.A)("dc-btn__button-group","da-api-token__button",{"da-api-token__button--success":S}),type:"submit",is_disabled:!a||_||!t||!y(e).length,has_effect:!0,is_loading:_,is_submit_success:S,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Create"})})]})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy and paste the token into the app."}),children:(0,x.jsx)(N,{})})]})]})})]}),_&&(0,x.jsx)(m,{})]})})})}))}}]);
//# sourceMappingURL=account.Sections_Security_ApiToken_index_ts.27c306511b086b931cd4.js.map