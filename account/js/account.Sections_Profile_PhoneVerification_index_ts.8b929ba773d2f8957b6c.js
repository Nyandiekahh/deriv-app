"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Profile_PhoneVerification_index_ts"],{"./Sections/Profile/PhoneVerification/index.ts":(e,t,i)=>{i.r(t),i.d(t,{default:()=>J});var o=i("react"),n=i.n(o),a=i("react-router-dom"),s=i("@deriv/components"),r=i("@deriv/hooks"),l=i("@deriv/quill-icons"),c=i("@deriv/shared"),d=i("@deriv/stores"),_=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Button/icon-button/index.js"),u=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Typography/text/index.js"),h=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),m=i("@deriv-com/translations"),p=i("../../../node_modules/clsx/dist/clsx.mjs"),f=i("../../../node_modules/@deriv-com/quill-ui/dist/snackbar-controller-ChcV5SXl.js"),v=i("../../../node_modules/@deriv-com/quill-ui/dist/jsx-runtime-DmTjM30f.js"),b=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Input/base/index.js"),x=i("../../../node_modules/@deriv-com/quill-ui/dist/clsx-OuTLNxxd.js");const j=(0,o.forwardRef)((({addOnPosition:e="left",variant:t="outline",fillAddonBorderColor:i,rightIcon:o,addonLabel:n,inputSize:a="lg",disabled:s,...r},l)=>{const c="fill"===t?{borderColor:i}:{},d=v.j.jsx("div",{className:(0,x.c)("quill-addon",`quill-addon__position--${e}`,`quill-addon__position--${e}--${t}`,`quill-addon__variant--${t}`),style:c,children:v.j.jsx(u.E,{size:"lg"===a?"md":a,className:(0,x.c)(s&&"quill-addon__label--disabled"),children:n})}),_=v.j.jsx("span",{className:"icon_wrapper",children:o});return v.j.jsx(b.A,{addOn:d,disabled:s,addOnIcon:_,variant:t,inputSize:a,ref:l,...r})}));var g=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Button/base/index.js"),w=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Snackbar/snackbar.js"),E=i("../../../node_modules/yup/es/index.js"),S=i("@deriv-com/utils");const y=/^[0-9]{5,15}$/,C=(e,t,i,o)=>{(e=>E.Yj().matches(e?y:S.ValidationConstants.patterns.phoneNumber,(0,m.localize)("Enter a valid phone number.")))(o).validate(e).then((()=>{t(""),i(!1)})).catch((({errors:e})=>{t(e),i(!0)}))};var I=i("../../../node_modules/react/jsx-runtime.js");const M=(0,d.observer)((({show_confirm_phone_number:e,setOtpVerification:t})=>{const[i,n]=(0,o.useState)(""),[a,s]=(0,o.useState)(""),[l]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),[_,h]=(0,o.useState)(!1),{requestOnSMS:v,requestOnWhatsApp:b,error_message:x,setErrorMessage:E,setUsersPhoneNumber:S,is_email_verified:y,email_otp_error:M,is_disabled_request_button:V,setIsDisabledRequestButton:P}=(0,r.useRequestPhoneNumberOTP)(),{is_global_sms_available:O,is_global_whatsapp_available:z,no_of_available_carriers:N,formatted_countries_list:L,short_code_selected:k,selected_phone_code:T,selected_country_list:A,isLoading:B}=(0,r.useGetPhoneNumberList)(),{data:R,invalidate:q}=(0,r.useSettings)(),[F,$]=(0,o.useState)(),{ui:H}=(0,d.useStore)(),{setShouldShowPhoneNumberOTP:G}=H,{next_phone_otp_request_timer:D,is_phone_otp_timer_loading:W}=(0,r.usePhoneNumberVerificationSetTimer)(!0),{trackPhoneVerificationEvents:Y}=(0,r.usePhoneVerificationAnalytics)(),{localize:K}=(0,m.useTranslations)(),U=1===N;(0,o.useEffect)((()=>{e&&Y({action:"open",subform_name:"verify_phone_screen"})}),[e,Y]),(0,o.useEffect)((()=>{n(R?.phone?.replace(/\D/g,"")||"")}),[R?.phone]),(0,o.useEffect)((()=>{M&&(Y({action:"error",subform_name:"verify_phone_screen",error_code:M.code}),q("get_settings").then((()=>h(!1)))),y&&(h(!1),t({show_otp_verification:!0,phone_verification_type:a}),G(!0))}),[y,M,q,Y]);const X=e=>{n(e.target.value),C(l?e.target.value:`+${e.target.value}`,E,P,!!l)},J=async e=>{h(!0),s(e);const{error:t}=await S({phone:l?i:`+${i}`,...l?{calling_country_code:F?.phone_code||T}:{}});t?h(!1):(Y({action:"click_cta",cta_name:e===c.VERIFICATION_SERVICES.SMS?"Get code via SMS":"Get code via WhatsApp",subform_name:"verify_phone_screen"}),e===c.VERIFICATION_SERVICES.SMS?v():b())},Q=e=>1===e,Z=!l||(F?F?.carriers.includes("sms")&&O:A?.carriers.includes("sms")&&O),ee=!l||(F?F?.carriers.includes("whatsapp")&&z:A?.carriers.includes("whatsapp")&&z);return(0,I.jsxs)(o.Fragment,{children:[(0,I.jsx)(u.E,{bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Step 2 of 3: Confirm your phone number"})}),(0,I.jsx)("div",{className:(0,p.A)("phone-verification__card--inputfield",{"phone-verification__card--inputfield--error":x}),children:l?L&&!B&&(0,I.jsx)(f.b,{showSearchBar:!0,codeIcon:!1,countryCodes:L,codeLabel:K("Code"),shortCode:F?.short_code||k,onCodeChange:e=>{$(e)},value:i,showFlags:!1,label:K("Phone number"),onChange:X,status:x?"error":"neutral",message:x}):(0,I.jsx)(j,{type:"number",label:K("Phone number"),value:i,status:x?"error":"neutral",message:x,className:"phone-verification__card--inputfield__phone-number-input",onChange:X,addonLabel:"+"})}),(0,I.jsxs)("div",{className:(0,p.A)("phone-verification__card--buttons_container",{"phone-verification__card--buttons_container--with-1-carrier":U}),children:[(!l||Z)&&!B&&(0,I.jsx)(g.$n,{variant:l?ee?"secondary":"primary":"secondary",color:l?ee?"black-white":"coral":"black-white",fullWidth:!l||ee,size:"lg",onClick:()=>J(c.VERIFICATION_SERVICES.SMS),disabled:_||!!D||V||W,children:(0,I.jsx)(u.E,{color:l?ee?"black":"white":"black",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Get code via SMS"})})}),(!l||ee)&&!B&&(0,I.jsx)(g.$n,{color:"coral",fullWidth:!l||Z,size:"lg",onClick:()=>J(c.VERIFICATION_SERVICES.WHATSAPP),disabled:_||!!D||V||W,children:(0,I.jsx)(u.E,{color:"white",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Get code via WhatsApp"})})})]}),(0,I.jsx)(w.q,{hasCloseButton:!1,message:(0,I.jsx)(m.Localize,{i18n_default_text:"Request new code in {{next_phone_number_attempt_timestamp}}.",values:{next_phone_number_attempt_timestamp:(()=>{let e="";return e=D?D<60?`${D} ${Q(D)?K("second"):K("seconds")}`:`${Math.round(D/60)} ${Q(Math.round(D/60))?K("minute"):K("minutes")}`:"",e})()}}),isVisible:!!D})]})}));var V=i("react-router");const P=(0,d.observer)((()=>{const e=(0,V.useHistory)(),t=(0,V.useLocation)(),[i,n]=(0,o.useState)(!1),[a,s]=(0,o.useState)(t.pathname),{ui:l,client:c}=(0,d.useStore)(),{setShouldShowPhoneNumberOTP:_,is_forced_to_exit_pnv:p}=l,{setVerificationCode:v,is_virtual:b}=c,{isMobile:x}=(0,h.Y)(),{trackPhoneVerificationEvents:j}=(0,r.usePhoneVerificationAnalytics)(),{is_phone_number_verified:g}=(0,r.useIsPhoneNumberVerified)(),[w]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"phone_number_verification"});(0,o.useEffect)((()=>{const t=e.block((e=>!(!(i||b||p||g)&&w)||(n(!0),s(e.pathname),!1)));return()=>t()}),[e,i,b,p,g,w]);return(0,I.jsxs)(f.M,{isMobile:x,showHandleBar:!0,isOpened:i,isNonExpandable:!0,shouldCloseModalOnSwipeDown:!0,shouldCloseOnPrimaryButtonClick:!0,primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Continue verification"}),buttonColor:"coral",showSecondaryButton:!0,showCrossIcon:!0,toggleModal:()=>{n(!1),s(t.pathname)},secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel"}),secondaryButtonCallback:()=>{a&&(v("","phone_number_verification"),_(!1),n(!1),j({action:"back"}),e.push(a))},children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel phone number verification?"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__cancel-modal--contents",children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"If you cancel, you'll lose all progress."})})})})]})}));var O=i("./Helpers/utils.tsx"),z=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Typography/caption/index.js");const N=({is_button_disabled:e,should_show_resend_code_button:t,clearOtpValue:i,setIsButtonDisabled:a,setShouldShowDidntGetTheCodeModal:s,reInitializeGetSettings:l})=>{const{sendPhoneNumberVerifyEmail:c,WS:d,error:_}=(0,r.useVerifyEmail)("phone_number_verification"),{is_request_button_disabled:u,next_email_otp_request_timer:h,next_phone_otp_request_timer:p}=(0,r.usePhoneNumberVerificationSetTimer)(),{localize:f}=(0,m.useTranslations)();n().useEffect((()=>{(d.isSuccess||_)&&l()}),[d.isSuccess,l,_]);const v=(0,o.useCallback)((()=>t?!!h||e:!!p||e||u),[t,h,p,e,u]);return(0,I.jsx)(g.$n,{variant:"tertiary",onClick:()=>{t?(i(),a(!0),c()):s(!0)},disabled:v(),color:"black",children:(0,I.jsx)(z.O,{bold:!0,underlined:!0,children:t?(0,I.jsx)(m.Localize,{i18n_default_text:"Resend code{{resendCode}}",values:{resendCode:(()=>{let e="";return e=h?h<60?`${f(" in ")}${h}s`:`${f(" in ")}${Math.round(h/60)}m`:"",e})()}}):(0,I.jsx)(m.Localize,{i18n_default_text:"Didn't get the code?{{resendCode}}",values:{resendCode:(()=>{let e="";return e=p?p<60?` (${p}s)`:` (${p&&Math.round(p/60)}m)`:"",e})()}})})})},L=({should_show_didnt_get_the_code_modal:e,setShouldShowDidntGetTheCodeModal:t,setIsButtonDisabled:i,reInitializeGetSettings:n,requestOnSMS:a,requestOnWhatsApp:s,clearOtpValue:r,phone_verification_type:l,is_email_verified:d,email_otp_error:_,setOtpVerification:u})=>{const{isMobile:p}=(0,h.Y)(),{localize:v}=(0,m.useTranslations)();(0,o.useEffect)((()=>{(d||_)&&n()}),[d,_,n]);const b=()=>{i(!0)};return(0,I.jsx)(f.M,{isMobile:p,showHandleBar:!0,isOpened:e,isNonExpandable:!0,shouldCloseModalOnSwipeDown:!0,showSecondaryButton:!0,primaryButtonCallback:()=>{r(),b(),l===c.VERIFICATION_SERVICES.SMS?a():s(),u({show_otp_verification:!0,phone_verification_type:l}),t(!1)},secondaryButtonCallback:()=>{r(),b();const e=l===c.VERIFICATION_SERVICES.SMS?c.VERIFICATION_SERVICES.WHATSAPP:c.VERIFICATION_SERVICES.SMS;l===c.VERIFICATION_SERVICES.SMS?s():a(),u({show_otp_verification:!0,phone_verification_type:e}),t(!1)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Resend code"}),buttonColor:"coral",secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Send code via {{phone_verification_type}}",values:{phone_verification_type:v((0,O.E0)(l===c.VERIFICATION_SERVICES.SMS?c.VERIFICATION_SERVICES.WHATSAPP:c.VERIFICATION_SERVICES.SMS))}}),showCrossIcon:!0,toggleModal:()=>t(!1),children:(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Didn't receive a code?"})})})},k=(0,d.observer)((({should_show_phone_number_verified_modal:e})=>{const t=(0,a.useHistory)(),i=localStorage.getItem("routes_from_notification_to_pnv"),n=i!==c.routes.personal_details&&i!==c.routes.phone_verification&&!!i,[s]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{isMobile:l}=(0,h.Y)(),{ui:_,client:{account_settings:p}}=(0,d.useStore)(),{setIsPhoneVerificationCompleted:v,setShouldShowPhoneNumberOTP:b}=_,{trackPhoneVerificationEvents:x}=(0,r.usePhoneVerificationAnalytics)();return(0,o.useEffect)((()=>{e&&(x({action:"open",subform_name:"verification_successful"}),b(!1),v(!0))}),[e,x]),(0,I.jsxs)(f.M,{isMobile:l,isOpened:e,showHandleBar:!1,showCrossIcon:!1,isNonExpandable:!0,buttonColor:"coral",primaryButtonCallback:()=>{localStorage.removeItem("routes_from_notification_to_pnv"),n?t.push(i):t.push(c.routes.traders_hub)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),disableCloseOnOverlay:!0,children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Phone number verified"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__verified-modal--contents",children:(0,I.jsxs)("div",{className:"phone-verification__verified-modal--contents__phone-number-container",children:[(0,I.jsx)("div",{className:"phone-verification__verified-modal--contents__phone-number-container__phone-number",children:s?`+${p?.calling_country_code}${p?.phone}`:`${p?.phone}`})," ",(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:" is verified as your phone number."})})]})})})]})})),T=(0,d.observer)((({show_cool_down_period_modal:e,setShowCoolDownPeriodModal:t})=>{const{ui:i}=(0,d.useStore)(),o=(0,V.useHistory)(),n=localStorage.getItem("routes_from_notification_to_pnv"),a=n!==c.routes.personal_details&&n!==c.routes.phone_verification&&!!n,{isMobile:s}=(0,h.Y)(),{setIsForcedToExitPnv:r,setShouldShowPhoneNumberOTP:l}=i;return(0,I.jsxs)(f.M,{isOpened:e,isMobile:s,showCrossIcon:!1,showHandleBar:!1,isNonExpandable:!0,primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),primaryButtonCallback:()=>{l(!1),r(!1),t(!1),localStorage.removeItem("routes_from_notification_to_pnv"),a?o.push(n):o.push(c.routes.traders_hub)},disableCloseOnOverlay:!0,buttonColor:"coral",children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"OTP limit reached"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Request a new OTP after 10 minutes."})})})]})})),A=(0,d.observer)((({phone_verification_type:e,setOtpVerification:t})=>{const{client:i,ui:n}=(0,d.useStore)(),{setVerificationCode:a,is_authorize:s}=i,{data:l,invalidate:_}=(0,r.useSettings)(),[h,p]=(0,o.useState)(!1),[v,b]=(0,o.useState)(""),[x,j]=(0,o.useState)(!1),{trackPhoneVerificationEvents:w}=(0,r.usePhoneVerificationAnalytics)(),{localize:E}=(0,m.useTranslations)(),S=(0,c.useIsMounted)(),[y]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{sendPhoneOTPVerification:C,phone_otp_error_message:M,setPhoneOtpErrorMessage:V,is_phone_number_verified:P,is_email_verified:z,show_cool_down_period_modal:A,setShowCoolDownPeriodModal:B,sendEmailOTPVerification:R,requestOnSMS:q,requestOnWhatsApp:F,email_otp_error:$,reset:H}=(0,r.useSendOTPVerificationCode)(),{setNextEmailOtpRequestTimer:G,is_email_otp_timer_loading:D,setNextPhoneOtpRequestTimer:W,is_phone_otp_timer_loading:Y}=(0,r.usePhoneNumberVerificationSetTimer)(),{should_show_phone_number_otp:K,setIsForcedToExitPnv:U}=n,X=(0,o.useCallback)((()=>{_("get_settings").then((()=>{S()&&j(!1)}))}),[_]);(0,o.useEffect)((()=>{$&&w({action:"error",subform_name:K?"verify_phone_otp_screen":"verify_email_screen",error_code:$.code})}),[$,w,K]),(0,o.useEffect)((()=>{w(K?{action:"open",subform_name:"verify_phone_otp_screen"}:{action:"open",subform_name:"verify_email_screen"})}),[K,w]),(0,o.useEffect)((()=>{s&&(j(!0),X())}),[X,s]),(0,o.useEffect)((()=>{P?U(!0):z&&!K&&(a(v,"phone_number_verification"),t({show_otp_verification:!1,phone_verification_type:""}))}),[P,z,t,K]);const J=()=>{b(""),V(""),K?W(void 0):G(void 0),H()},Q=()=>{K?(w({action:"click_cta",subform_name:"verify_phone_otp_screen"}),C(v)):(w({action:"click_cta",subform_name:"verify_email_screen"}),R(v))};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(T,{show_cool_down_period_modal:A,setShowCoolDownPeriodModal:B}),(0,I.jsx)(k,{should_show_phone_number_verified_modal:P}),K&&(0,I.jsx)(L,{clearOtpValue:J,setIsButtonDisabled:j,reInitializeGetSettings:X,requestOnSMS:q,requestOnWhatsApp:F,email_otp_error:$,is_email_verified:z,should_show_didnt_get_the_code_modal:h,setShouldShowDidntGetTheCodeModal:p,phone_verification_type:e,setOtpVerification:t}),(0,I.jsx)(u.E,{bold:!0,children:K?(0,I.jsx)(m.Localize,{i18n_default_text:"Step 3 of 3: Verify your number"}):(0,I.jsx)(m.Localize,{i18n_default_text:"Step 1 of 3: Email verification needed"})}),(0,I.jsx)("div",{className:"phone-verification__card--email-verification-content",children:K?(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"Enter the 6-digit code sent to you via {{phone_verification_type}} at <1>{{users_phone_number}}</1>. <0></0>",values:{phone_verification_type:E((0,O.E0)(e)),users_phone_number:y?`+${l?.calling_country_code}${l?.phone}`:`${l?.phone}`},components:[(0,I.jsx)(g.$n,{variant:"tertiary",label:E("Edit number"),size:"sm",color:"black-white",onClick:()=>t({show_otp_verification:!1,phone_verification_type:e})},0),(0,I.jsx)("span",{className:"phone-verification__card--email-verification-content__phone-number"},1)]})}):(0,I.jsxs)(o.Fragment,{children:[(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"We've sent a verification code to <0>{{users_email}}</0>.",values:{users_email:l?.email},components:[(0,I.jsx)("strong",{},0)]})}),(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"Enter the code below to verify it's you."})})]})}),(0,I.jsxs)("div",{className:"phone-verification__card--email-verification-otp-container",children:[(0,I.jsx)(f.c,{status:M?"error":"neutral",buttonLabel:E("Verify"),label:E(K?"OTP code":"Verification code"),buttonCallback:Q,onKeyDown:e=>{"Enter"===e.key&&Q()},inputMode:"numeric",buttonColor:"coral",onChange:e=>{b(e.target.value),V("")},message:M,value:v,type:"number",maxLength:6,buttonDisabled:v.length<6}),(0,I.jsx)(N,{clearOtpValue:J,is_button_disabled:x||(K?Y:D),setIsButtonDisabled:j,should_show_resend_code_button:!K,setShouldShowDidntGetTheCodeModal:p,reInitializeGetSettings:X})]})]})})),B=(0,d.observer)((({is_at_otp_verification:e})=>{const{isMobile:t}=(0,h.Y)(),i=(0,V.useHistory)(),{localize:n}=(0,m.useTranslations)(),{should_show_session_timeout_modal:a}=(0,r.usePhoneNumberVerificationSessionTimer)(),{ui:s}=(0,d.useStore)(),{is_phone_verification_completed:l,setShouldShowPhoneNumberOTP:_,setIsForcedToExitPnv:p,should_show_phone_number_otp:v}=s,{trackPhoneVerificationEvents:b}=(0,r.usePhoneVerificationAnalytics)();(0,o.useEffect)((()=>{a&&(p(!0),b({action:"open_session_expired_popup",subform_name:e?v?"verify_phone_otp_screen":"verify_email_screen":"verify_phone_screen"}))}),[a,b]);return(0,I.jsxs)(f.M,{isMobile:t,isOpened:a&&!l,showCrossIcon:!1,showHandleBar:!1,isNonExpandable:!0,primaryButtonCallback:()=>{p(!1),_(!1),i.push(c.routes.personal_details)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),buttonColor:"coral",title:n("Session Expired"),disableCloseOnOverlay:!0,children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Session expired"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Restart your phone number verification."})})})]})})),R=(0,d.observer)((({should_show_verification_link_expired_modal:e,setShouldShowVerificationLinkExpiredModal:t})=>{const i=(0,V.useHistory)(),{ui:n}=(0,d.useStore)(),{setIsForcedToExitPnv:a}=n,{sendPhoneNumberVerifyEmail:s,WS:l}=(0,r.useVerifyEmail)("phone_number_verification"),{next_email_otp_request_timer:_,is_email_otp_timer_loading:p,setNextEmailOtpRequestTimer:v}=(0,r.usePhoneNumberVerificationSetTimer)(),{invalidate:b}=(0,r.useSettings)(),{isMobile:x}=(0,h.Y)(),{localize:j}=(0,m.useTranslations)();return(0,o.useEffect)((()=>{l.isSuccess&&b("get_settings").then((()=>t(!1)))}),[l.isSuccess,b]),(0,I.jsxs)(f.M,{isMobile:x,isOpened:e,isPrimaryButtonDisabled:!!_||p,buttonColor:"coral",showCrossIcon:!1,showHandleBar:!1,disableCloseOnOverlay:!0,isNonExpandable:!0,primaryButtonCallback:()=>{s(),v(void 0),a(!1)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Send new link{{next_email_attempt_timestamp}}",values:{next_email_attempt_timestamp:(()=>{let e="";return e=_?_<60?`${j(" in ")}${_}s`:`${j(" in ")}${Math.round(_/60)}m`:"",e})()}}),toggleModal:()=>t(!1),showSecondaryButton:!0,secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel"}),secondaryButtonCallback:()=>{a(!1),t(!1),i.push(c.routes.personal_details)},children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Link expired"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__cancel-modal--contents",children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Request a new verification link via email."})})})})]})}));var q=i("../../../node_modules/@deriv-com/quill-ui/dist/LabelPairedCircleInfoSmRegularIcon-CnUvtxa5.js");const F=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 4.625a6.11 6.11 0 0 0-5.305 3.063c-1.12 1.914-1.12 4.238 0 6.125C2.79 15.727 4.785 16.875 7 16.875a6.04 6.04 0 0 0 5.277-3.062c1.121-1.887 1.121-4.211 0-6.126A6.1 6.1 0 0 0 7 4.626M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m2.926-8.422-3.5 3.5a.463.463 0 0 1-.63 0l-1.75-1.75a.463.463 0 0 1 0-.629.463.463 0 0 1 .63 0l1.449 1.45 3.172-3.2a.463.463 0 0 1 .629 0 .463.463 0 0 1 0 .63"})),o.createElement("defs",null,o.createElement("clipPath",{id:"9dd3266b3a0417e9963724a864a443a9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),$=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m3.09-8.285-3.5 3.5c-.274.273-.684.273-.93 0l-1.75-1.75a.6.6 0 0 1 0-.902c.246-.274.656-.274.93 0l1.285 1.285L9.16 8.562c.246-.273.656-.273.93 0a.644.644 0 0 1 0 .903"})),o.createElement("defs",null,o.createElement("clipPath",{id:"9667f2bfeac4e36d18c79ef42cdab30a__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),H=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M.93 15.262c-.055.082-.055.164-.055.246 0 .273.219.52.492.52h11.238c.274 0 .52-.247.52-.52a.44.44 0 0 0-.082-.246L7.547 5.828A.66.66 0 0 0 7 5.5a.67.67 0 0 0-.574.328zm-.766-.438L5.66 5.391A1.57 1.57 0 0 1 7 4.625c.52 0 1.04.3 1.313.766l5.496 9.433c.109.192.191.438.191.684 0 .765-.629 1.367-1.395 1.367H1.367A1.354 1.354 0 0 1 0 15.508c0-.246.055-.492.164-.684M7 8.125a.47.47 0 0 1 .438.438v3.5A.45.45 0 0 1 7 12.5a.43.43 0 0 1-.437-.437v-3.5A.45.45 0 0 1 7 8.124m-.656 6.125c0-.355.273-.656.656-.656.355 0 .656.3.656.656 0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"0c2f8e90d9f75dcf30ea1d2e60f5d0d9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),G=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"m6.781 6.074-5.414 8.887c-.054.082-.054.137-.054.219 0 .218.164.383.382.383h10.582c.22 0 .41-.165.41-.383 0-.082-.027-.137-.082-.22L7.192 6.075A.21.21 0 0 0 7 5.938c-.11 0-.164.054-.219.136m-1.12-.683A1.57 1.57 0 0 1 7 4.625c.52 0 1.04.3 1.313.766l5.414 8.886c.164.274.273.575.273.903 0 .93-.766 1.695-1.723 1.695H1.695C.765 16.875 0 16.109 0 15.18q0-.493.246-.903zm2.214 8.422c0 .492-.41.874-.875.874a.864.864 0 0 1-.875-.874c0-.465.383-.876.875-.876a.9.9 0 0 1 .875.876M7.656 8.78v2.625c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656V8.781c0-.355.273-.656.656-.656.355 0 .656.3.656.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"48f2db37f605b08a690e0494ee27901d__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),D=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 4.625a6.11 6.11 0 0 0-5.305 3.063c-1.12 1.914-1.12 4.238 0 6.125C2.79 15.727 4.785 16.875 7 16.875a6.04 6.04 0 0 0 5.277-3.062c1.121-1.887 1.121-4.211 0-6.126A6.1 6.1 0 0 0 7 4.626M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m0-10.5a.47.47 0 0 1 .438.438v3.5a.45.45 0 0 1-.438.437.43.43 0 0 1-.437-.437v-3.5A.45.45 0 0 1 7 7.25m.656 6.125c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656c0-.355.273-.656.656-.656.355 0 .656.3.656.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"a7482d221eb247f9f8bcd9c9acfe3778__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),W=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m0-10.5c.355 0 .656.3.656.656v3.063c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656V7.906c0-.355.273-.656.656-.656m.875 6.125c0 .492-.41.875-.875.875a.864.864 0 0 1-.875-.875c0-.465.383-.875.875-.875a.9.9 0 0 1 .875.875"})),o.createElement("defs",null,o.createElement("clipPath",{id:"899cb56538ebdf1d12f18f1e915b18f9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),Y=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m-1.094-4.812h.657v-1.75h-.657a.63.63 0 0 1-.656-.657c0-.355.273-.656.656-.656H7.22c.355 0 .656.3.656.656v2.406h.219c.355 0 .656.301.656.657 0 .383-.3.656-.656.656H5.906a.63.63 0 0 1-.656-.656c0-.356.273-.656.656-.656M7 9a.864.864 0 0 1-.875-.875c0-.465.383-.875.875-.875a.9.9 0 0 1 .875.875c0 .492-.41.875-.875.875"})),o.createElement("defs",null,o.createElement("clipPath",{id:"6bb7294d410046a35078a61ab3d31971__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),K=({icon:e,size:t,className:i,isBold:o,color:n})=>{const a={error:{bold:v.j.jsx(G,{}),regular:v.j.jsx(H,{})},warning:{bold:v.j.jsx(W,{}),regular:v.j.jsx(D,{})},success:{bold:v.j.jsx($,{}),regular:v.j.jsx(F,{})},info:{bold:v.j.jsx(Y,{}),regular:v.j.jsx(q.F,{})}};let s;return s="custom"===n?e:a[n??"success"][o?"bold":"regular"],v.j.jsx(v.j.Fragment,{children:e&&"custom"===n?v.j.jsx("div",{className:(0,x.c)("tag__icon",`tag__icon--${t}`,i),children:e}):v.j.jsx(v.j.Fragment,{children:s&&v.j.jsx("div",{className:(0,x.c)("tag__icon",`tag__color--${n}-svg`,`tag__icon--${t}`),children:s})})})},U=(0,o.forwardRef)((({label:e,className:t,variant:i="fill",size:o="md",color:n="success",isBold:a=!1,icon:s,iconClassName:r,showIcon:l=!0,...c},d)=>{const _="custom"===i?"custom":n;return v.j.jsxs("div",{className:(0,x.c)(t,"tag",`tag__size-${o}`,`tag__color--${_}`,`tag__color--${_}-${i}`),style:"custom"===i?{backgroundColor:n}:void 0,...c,ref:d,children:[l&&v.j.jsx(K,{isBold:a,className:r,icon:s,color:_,size:o}),"string"!=typeof e?e:v.j.jsx(v.j.Fragment,{children:"sm"===o||"xs"===o?v.j.jsx(z.O,{bold:a,color:_,children:e}):v.j.jsx(u.E,{size:"md"===o?"sm":"md",bold:a,color:_,children:e})})]})}));U.displayName="Tag";const X=({children:e,is_small_card:t})=>{const{formatted_time:i}=(0,r.usePhoneNumberVerificationSessionTimer)();return(0,I.jsxs)("div",{className:(0,p.A)("phone-verification__card",{"phone-verification__card--small-card":t}),children:[(0,I.jsx)("div",{className:"phone-verification__card--session-timeout-component",children:(0,I.jsx)(U,{showIcon:!1,size:"sm",variant:"custom",color:"#f5f5f5",label:(0,I.jsx)(m.Localize,{i18n_default_text:"Time remaining: {{time_remaining}}",values:{time_remaining:i}})})}),e]})},J=(0,d.observer)((()=>{const e=(0,a.useHistory)(),[t,i]=(0,o.useState)({show_otp_verification:!0,phone_verification_type:""}),n=sessionStorage.getItem("phone_number_verification_code"),[p,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(!1),{sendEmailOTPVerification:x,email_otp_error:j,is_email_verified:g}=(0,r.useSendOTPVerificationCode)(),{is_phone_number_verified:w}=(0,r.useIsPhoneNumberVerified)(),[E,S]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"phone_number_verification"}),[y,C]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{isDesktop:V}=(0,h.Y)(),{client:O,ui:z}=(0,d.useStore)(),{is_redirected_from_email:N,setRedirectFromEmail:L,setIsForcedToExitPnv:k}=z,{verification_code:{phone_number_verification:T},is_authorize:q,is_virtual:F,setVerificationCode:$,phone_settings:H}=O,G=H?.carriers&&0===H?.carriers.length;return(0,o.useEffect)((()=>{(S&&!E||F||w||C&&!y&&G)&&(k(!0),e.push(c.routes.personal_details))}),[S,E,F,e,w]),(0,o.useEffect)((()=>{(N||n)&&(f(!0),j?(f(!1),k(!0),b(!0),L(!1),sessionStorage.removeItem("phone_number_verification_code")):g?(f(!1),i({show_otp_verification:!1,phone_verification_type:""}),L(!1),sessionStorage.removeItem("phone_number_verification_code")):(T||n)&&q&&(n&&$(n,"phone_number_verification"),x(n||T)))}),[j,g,T,q,N,n]),p||!S?(0,I.jsx)(s.Loading,{is_fullscreen:!1}):(0,I.jsxs)("div",{children:[(0,I.jsx)(R,{should_show_verification_link_expired_modal:v,setShouldShowVerificationLinkExpiredModal:b}),!v&&(0,I.jsx)(B,{is_at_otp_verification:t.show_otp_verification}),(0,I.jsx)(P,{}),V&&(0,I.jsxs)("div",{className:"phone-verification__redirect_button",children:[(0,I.jsx)(_.K,{color:"black-white",variant:"tertiary",onClick:()=>{e.push(c.routes.personal_details)},icon:(0,I.jsx)(l.LabelPairedArrowLeftCaptionFillIcon,{width:24,height:24,"data-testid":"dt_phone_verification_back_btn",className:"phone-verification__redirect_button--icon"})}),(0,I.jsx)(u.E,{className:"phone-verification__redirect_button--text",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Back to personal details"})})]}),(0,I.jsx)(X,{is_small_card:t.show_otp_verification,children:t.show_otp_verification?(0,I.jsx)(A,{phone_verification_type:t.phone_verification_type,setOtpVerification:i}):(0,I.jsx)(M,{show_confirm_phone_number:!t.show_otp_verification,setOtpVerification:i})})]})}))}}]);
//# sourceMappingURL=account.Sections_Profile_PhoneVerification_index_ts.8b929ba773d2f8957b6c.js.map