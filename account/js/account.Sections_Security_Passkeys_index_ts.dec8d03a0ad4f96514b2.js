"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_Passkeys_index_ts"],{"./Sections/Security/Passkeys/index.ts":(e,s,t)=>{t.r(s),t.d(s,{default:()=>V});var a=t("react"),i=t("react-router-dom"),o=t("@deriv/components"),n=t("@deriv/hooks"),r=t("@deriv/shared"),l=t("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),c=t("@deriv/stores"),d=t("@deriv-com/translations"),_=t("../../../node_modules/yup/es/index.js"),u=t("@deriv-com/analytics");const x="created",y="learn_more",p="",m="no_passkey",k="removed",h="removing",j="renaming",f=e=>{e.current&&clearTimeout(e.current)},g=e=>"NotSupportedError"===e?.name,z=["NotAllowedError","AbortError","NotReadableError","UnknownError"],v=["ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"],C=(e,s={})=>{u.Analytics.trackEvent("ce_passkey_account_settings_form",{action:e,form_name:"ce_passkey_account_settings_form",operating_system:(0,r.getOSNameWithUAParser)(),...s})};var L=t("../../../node_modules/react/jsx-runtime.js");const b=({is_modal_open:e,error:s,onButtonClick:t})=>{const a=(e=>({error_message_header:(0,L.jsx)(o.Text,{size:"xs",weight:"bold",children:g(e)?(0,L.jsx)(d.Localize,{i18n_default_text:"Passkey setup failed"}):(0,L.jsx)(d.Localize,{i18n_default_text:"Unable to process your request"})}),error_message:g(e)?(0,L.jsx)(d.Localize,{i18n_default_text:"This device doesn't support passkeys."}):(0,L.jsx)(d.Localize,{i18n_default_text:"We’re experiencing a temporary issue in processing your request. Please try again later."})}))(s);return(0,L.jsxs)(o.Modal,{portalId:"modal_root",header:a.error_message_header,is_open:e,has_close_icon:!1,className:"passkeys-modal",children:[(0,L.jsx)(o.Modal.Body,{children:a.error_message}),(0,L.jsx)(o.Modal.Footer,{children:(0,L.jsx)(o.Button,{onClick:t,large:!0,primary:!0,children:(0,L.jsx)(d.Localize,{i18n_default_text:"OK"})})})]})},B=()=>{const e=[(0,L.jsx)(d.Localize,{i18n_default_text:"Enable screen lock on your device."},"tip_1"),(0,L.jsx)(d.Localize,{i18n_default_text:"Enable bluetooth."},"tip_2"),(0,L.jsx)(d.Localize,{i18n_default_text:"Sign in to your Google or iCloud account."},"tip_3")];return(0,L.jsx)("ul",{children:e.map((e=>(0,L.jsx)(o.Text,{as:"li",size:"xxs",line_height:"l",children:e},e.key)))})},S=({is_modal_open:e,onButtonClick:s,toggleModal:t})=>{const a=(0,L.jsx)(o.Text,{size:"xs",weight:"bold",children:(0,L.jsx)(d.Localize,{i18n_default_text:"Just a reminder"})});return(0,L.jsxs)(o.Modal,{portalId:"modal_root",header:a,is_open:e,toggleModal:t,className:"passkeys-modal",children:[(0,L.jsx)(o.Modal.Body,{children:B()}),(0,L.jsx)(o.Modal.Footer,{children:(0,L.jsx)(o.Button,{onClick:s,large:!0,primary:!0,children:(0,L.jsx)(d.Localize,{i18n_default_text:"Continue"})})})]})},P=({is_modal_open:e,onPrimaryButtonClick:s,onSecondaryButtonClick:t,toggleModal:a})=>{const i=(0,L.jsx)(o.Text,{size:"xs",weight:"bold",children:(0,L.jsx)(d.Localize,{i18n_default_text:"Remove passkey"})});return(0,L.jsxs)(o.Modal,{portalId:"modal_root",header:i,is_open:e,toggleModal:a,className:"passkeys-modal",has_close_icon:!1,children:[(0,L.jsx)(o.Modal.Body,{children:(0,L.jsx)(o.Text,{size:"xxs",children:(0,L.jsx)(d.Localize,{i18n_default_text:"Are you sure you want to remove this passkey?"})})}),(0,L.jsxs)(o.Modal.Footer,{children:[(0,L.jsx)(o.Button,{onClick:t,large:!0,secondary:!0,children:(0,L.jsx)(d.Localize,{i18n_default_text:"Cancel"})}),(0,L.jsx)(o.Button,{onClick:s,large:!0,primary:!0,children:(0,L.jsx)(d.Localize,{i18n_default_text:"Remove"})})]})]})};var w=t("@deriv/quill-icons"),N=t("../../../node_modules/clsx/dist/clsx.mjs"),T=t("./Components/form-body/index.ts"),I=t("./Components/form-footer/index.ts");const E=({children:e,className:s,description:t,icon:i,onPrimaryButtonClick:n,onSecondaryButtonClick:r,primary_button_disabled:l=!1,primary_button_text:c,primary_button_type:d="button",scroll_offset:_="22rem",secondary_button_text:u,title:x})=>(0,L.jsxs)(a.Fragment,{children:[(0,L.jsxs)(T.A,{scroll_offset:_,className:(0,N.A)("passkeys-status__wrapper",s),children:[i,x&&(0,L.jsx)(o.Text,{as:"div",weight:"bold",align:"center",className:"passkeys-status__title",children:x}),t&&(0,L.jsx)(o.Text,{as:"div",size:"xs",align:"center",children:t}),e]}),(0,L.jsxs)(I.A,{className:"passkeys-status__footer",children:[u&&(0,L.jsx)(o.Button,{type:"button",has_effect:!0,secondary:!0,onClick:r,large:!0,children:u}),(0,L.jsx)(o.Button,{type:d,has_effect:!0,primary:!0,onClick:"button"===d?()=>n?.():void 0,is_disabled:l,children:c})]})]}),M=({onPrimaryButtonClick:e,onSecondaryButtonClick:s})=>(0,L.jsx)("div",{className:"passkeys",children:(0,L.jsx)(E,{description:(0,L.jsx)(d.Localize,{i18n_default_text:"Enhanced security is just a tap away."}),icon:(0,L.jsx)(w.DerivLightIcAddPasskeyIcon,{height:"96px",width:"96px"}),title:(0,L.jsx)(d.Localize,{i18n_default_text:"Experience safer logins"}),onPrimaryButtonClick:e,onSecondaryButtonClick:s,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Create passkey"}),secondary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Learn more"})})}),R=({onPrimaryButtonClick:e,onSecondaryButtonClick:s})=>(0,L.jsx)("div",{className:"passkeys",children:(0,L.jsx)(E,{description:(0,L.jsx)(d.Localize,{i18n_default_text:"Your account is now secured with a passkey.<0/>Manage your passkey through your<0/>Deriv account settings.",components:[(0,L.jsx)("br",{},0)]}),icon:(0,L.jsx)(w.DerivLightIcSuccessPasskeyIcon,{height:"96px",width:"96px"}),title:(0,L.jsx)(d.Localize,{i18n_default_text:"Success!"}),onPrimaryButtonClick:e,onSecondaryButtonClick:s,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Continue trading"}),secondary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Add more passkeys"})})}),A=()=>{const e=[{id:1,question:(0,L.jsx)(d.Localize,{i18n_default_text:"What are passkeys?"}),descriptions:[(0,L.jsx)(d.Localize,{i18n_default_text:"Secure alternative to passwords."},"1.1"),(0,L.jsx)(d.Localize,{i18n_default_text:"Unlock your account like your phone - with biometrics, face scan or PIN."},"1.2")]},{id:2,question:(0,L.jsx)(d.Localize,{i18n_default_text:"Why passkeys?"}),descriptions:[(0,L.jsx)(d.Localize,{i18n_default_text:"Extra security layer."},"2.1"),(0,L.jsx)(d.Localize,{i18n_default_text:"Shields against unauthorised access and phishing."},"2.2")]},{id:3,question:(0,L.jsx)(d.Localize,{i18n_default_text:"How to create a passkey?"}),descriptions:[(0,L.jsx)(d.Localize,{i18n_default_text:"Go to ‘Account Settings’ on Deriv."},"3.1"),(0,L.jsx)(d.Localize,{i18n_default_text:"You can create one passkey per device."},"3.2")]},{id:4,question:(0,L.jsx)(d.Localize,{i18n_default_text:"Where are passkeys saved?"}),descriptions:[(0,L.jsx)(d.Localize,{i18n_default_text:"Android: Google password manager."},"4.1"),(0,L.jsx)(d.Localize,{i18n_default_text:"iOS: iCloud keychain."},"4.2")]},{id:5,question:(0,L.jsx)(d.Localize,{i18n_default_text:"What happens if my Deriv account email is changed?"}),descriptions:[(0,L.jsx)(d.Localize,{i18n_default_text:"No problem! Your passkey still works."},"5.1"),(0,L.jsx)(d.Localize,{i18n_default_text:"Sign in to Deriv with your existing passkey."},"5.2")]}];return(0,L.jsx)("div",{className:"passkeys-status__description-container",children:e.map((({id:e,question:s,descriptions:t})=>(0,L.jsxs)("div",{className:"passkeys-status__description-card",children:[(0,L.jsx)(o.Text,{weight:"bold",size:"xs",children:s}),(0,L.jsx)(o.Text,{as:"ul",size:"xs",children:t.map((e=>(0,L.jsx)("li",{children:(0,L.jsx)(o.Text,{size:"xs",line_height:"l",children:e})},`description-${e.key}`)))})]},`description-card-${e}`)))})},D=()=>{const e=[{id:1,description:(0,L.jsx)(d.Localize,{i18n_default_text:"Enable screen lock on your device."})},{id:2,description:(0,L.jsx)(d.Localize,{i18n_default_text:"Sign in to your Google or iCloud account."})},{id:3,description:(0,L.jsx)(d.Localize,{i18n_default_text:"Enable Bluetooth."})}];return(0,L.jsxs)("div",{className:"passkeys-status__description-tips-wrapper",children:[(0,L.jsx)(o.Icon,{icon:"IcBulb",size:24}),(0,L.jsxs)("div",{className:"passkeys-status__description-tips-container",children:[(0,L.jsx)(o.Text,{weight:"bold",size:"xs",children:(0,L.jsx)(d.Localize,{i18n_default_text:"Tips:"})}),(0,L.jsx)(o.Text,{size:"xxs",line_height:"l",children:(0,L.jsx)(d.Localize,{i18n_default_text:"Before using passkey:"})}),(0,L.jsx)(o.Text,{as:"ul",size:"xxs",children:e.map((({id:e,description:s})=>(0,L.jsx)("li",{children:(0,L.jsx)(o.Text,{size:"xxs",line_height:"l",children:s})},`tip-${e}`)))})]})]})},O=({onPrimaryButtonClick:e,onSecondaryButtonClick:s})=>(0,L.jsxs)("div",{className:"passkeys",children:[(0,L.jsx)(o.Icon,{data_testid:"dt_learn_more_back_button",icon:"IcBackButton",onClick:s,className:"passkeys-status__description-back-button"}),(0,L.jsx)(E,{className:"passkeys-status__wrapper--expanded",description:(0,L.jsxs)(a.Fragment,{children:[(0,L.jsx)(A,{}),(0,L.jsx)(D,{})]}),icon:(0,L.jsx)(w.DerivLightIcInfoPasskeyIcon,{height:"96px",width:"96px",className:"passkey-status__icon"}),title:(0,L.jsx)(d.Localize,{i18n_default_text:"Effortless login with passkeys"}),onPrimaryButtonClick:e,onSecondaryButtonClick:s,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Create passkey"})})]}),q=({name:e,last_used:s,stored_on:t,id:a,icon:i,passkey_id:n,onPasskeyMenuClick:l})=>{const{localize:c}=(0,d.useTranslations)(),_={id:a,name:e,passkey_id:n};return(0,L.jsxs)("div",{className:"passkeys-card",children:[(0,L.jsx)(o.Icon,{icon:"IcPasskey",size:24}),(0,L.jsxs)("div",{className:"passkeys-card__passkey-name",children:[(0,L.jsx)(o.Text,{as:"p",weight:"bold",line_height:"l",children:e}),t&&(0,L.jsx)("div",{children:(0,L.jsxs)(o.Text,{as:"p",size:"xs",children:[(0,L.jsx)(d.Localize,{i18n_default_text:"Stored on: "})," ",t]})}),(0,L.jsx)("div",{children:(0,L.jsxs)(o.Text,{as:"p",size:"xs",children:[(0,L.jsx)(d.Localize,{i18n_default_text:"Last used: "})," ",s?(0,r.getLongDate)(s):(0,L.jsx)(d.Localize,{i18n_default_text:"Never"})]})}),i&&(0,L.jsx)(o.Icon,{icon:i,size:24,className:"passkeys-card__passkey-type-icon"})]}),(0,L.jsx)(o.Dropdown,{test_id:`dt_passkey_card_menu_${a}`,is_align_text_left:!0,list:[{text:c("Rename"),value:"rename"},{text:c("Remove"),value:"remove"}],onChange:e=>{"rename"===e.target.value?(l(j,_),C("passkey_rename_started")):"remove"===e.target.value&&(l(h,_),C("passkey_remove_started"))},suffix_icon:"IcMenuDots",suffix_icon_size:24})]})},F=({passkeys_list:e,onPrimaryButtonClick:s,onSecondaryButtonClick:t,onPasskeyMenuClick:i})=>(0,L.jsx)("div",{className:"passkeys",children:(0,L.jsx)(E,{className:"passkeys-list__wrapper",onPrimaryButtonClick:s,onSecondaryButtonClick:t,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Create passkey"}),scroll_offset:"16rem",secondary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Learn more"}),children:e.map((e=>(0,a.createElement)(q,{...e,key:e.passkey_id,onPasskeyMenuClick:i})))})});var Y=t("formik"),G=t("./Components/forms/form-fields/index.ts");const U=({onPrimaryButtonClick:e,onSecondaryButtonClick:s,current_managed_passkey:t})=>{const{localize:a}=(0,d.useTranslations)(),i={passkey_name:t.name};return(0,L.jsx)(Y.Formik,{initialValues:i,onSubmit:s=>{e({name:s.passkey_name})},validationSchema:_.Ik().shape({passkey_name:_.Yj().required("Only 3-30 characters allowed.").min(3,(0,d.localize)("Only 3-30 characters allowed.")).max(30,(0,d.localize)("Only 3-30 characters allowed.")).matches(/^[A-Za-z0-9][A-Za-z0-9\s-]*$/,(0,d.localize)("Only letters, numbers, space, and hyphen are allowed."))}),noValidate:!0,children:({dirty:t,isValid:i})=>(0,L.jsx)("div",{className:"passkeys",children:(0,L.jsx)(Y.Form,{children:(0,L.jsx)(E,{icon:(0,L.jsx)(w.DerivLightIcEditPasskeyIcon,{height:"96px",width:"96px"}),title:(0,L.jsx)(d.Localize,{i18n_default_text:"Edit passkey"}),onPrimaryButtonClick:e,onSecondaryButtonClick:s,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Save changes"}),secondary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Back"}),primary_button_disabled:!t||!i,primary_button_type:"submit",children:(0,L.jsx)(G.lp,{label:a("Passkey name"),name:"passkey_name"})})})})})},W=({onPrimaryButtonClick:e})=>{return(0,L.jsx)("div",{className:"passkeys",children:(0,L.jsx)(E,{description:(s=(0,r.getOSNameWithUAParser)(),"iOS"===s||"Mac OS"===s?(0,L.jsx)(d.Localize,{i18n_default_text:"Your passkey is successfully removed. To avoid sign-in prompts, also remove the passkey from your iCloud keychain."}):(0,L.jsx)(d.Localize,{i18n_default_text:"Your passkey is successfully removed. To avoid sign-in prompts, also remove the passkey from your Google password manager."})),icon:(0,L.jsx)(w.DerivLightIcSuccessPasskeyIcon,{height:"96px",width:"96px"}),title:(0,L.jsx)(d.Localize,{i18n_default_text:"Passkey successfully removed"}),onPrimaryButtonClick:e,primary_button_text:(0,L.jsx)(d.Localize,{i18n_default_text:"Continue"})})});var s},$=(0,c.observer)((({current_managed_passkey:e,onPrimaryButtonClick:s,onSecondaryButtonClick:t,passkeys_list:a,passkey_status:i,onPasskeyMenuClick:o})=>{switch(i){case x:return(0,L.jsx)(R,{onPrimaryButtonClick:s,onSecondaryButtonClick:t});case y:return(0,L.jsx)(O,{onPrimaryButtonClick:s,onSecondaryButtonClick:t});case m:return(0,L.jsx)(M,{onPrimaryButtonClick:s,onSecondaryButtonClick:t});case j:return(0,L.jsx)(U,{current_managed_passkey:e,onPrimaryButtonClick:s,onSecondaryButtonClick:t});case k:return(0,L.jsx)(W,{onPrimaryButtonClick:s});default:return(0,L.jsx)(F,{onPasskeyMenuClick:o,passkeys_list:a||[],onPrimaryButtonClick:s,onSecondaryButtonClick:t})}})),V=(0,c.observer)((()=>{const{client:e,common:s,notifications:t}=(0,c.useStore)(),{isMobile:_}=(0,l.Y)(),{is_passkey_supported:u,setShouldShowPasskeyNotification:g,setPasskeysStatusToCookie:B}=e,{removeNotificationByKey:w}=t,N="online"===s.network_status.class,T=(0,a.useRef)(null),I=(0,a.useRef)(null),E=(0,i.useHistory)(),[M,R]=(0,a.useState)(p),[A,D]=(0,a.useState)(!1),[O,q]=(0,a.useState)(!1),[F,Y]=(0,a.useState)(!1),[G,U]=(0,a.useState)({id:0,passkey_id:"",name:""}),{passkeys_list:W,is_passkeys_list_loading:V,passkeys_list_error:H,refetchPasskeysList:K}=(0,n.useGetPasskeysList)(),{passkey_removing_error:Z,removePasskey:J}=(0,n.useRemovePasskey)({onSuccess:()=>{K(),R(k),C("passkey_remove_success")}}),{passkey_renaming_error:Q,renamePasskey:X}=(0,n.useRenamePasskey)({onSuccess:()=>{K(),R(p),Y(!0),C("passkey_rename_success"),f(I),I.current=setTimeout((()=>{Y(!1)}),5e3)}}),{createPasskey:ee,startPasskeyRegistration:se,passkey_registration_error:te}=(0,n.useRegisterPasskey)({onSuccess:()=>{g(!1),w({key:"enable_passkey"}),K(),C("create_passkey_finished"),R(x),B("available")}}),ae=u&&_,ie=H||te||Q||Z;return(0,a.useEffect)((()=>{if(!V&&M!==x&&M!==k)return W?.length?R(p):(R(m),B("not_available")),()=>f(I)}),[V,W?.length]),(0,a.useEffect)((()=>{if(ie){if(C("error",{error_message:ie?.message}),z.some((e=>e===ie.name))||v.some((e=>e===ie.code)))return;M===h&&R(W?.length?p:m),A&&D(!1),f(T),T.current=setTimeout((()=>q(!0)),500)}return()=>f(T)}),[ie,A]),ae?V&&M===p||!N?(0,L.jsx)(o.Loading,{is_fullscreen:!1,className:"account__initial-loader"}):(0,L.jsxs)(a.Fragment,{children:[(0,L.jsx)($,{current_managed_passkey:G,onPasskeyMenuClick:(e,s)=>{e!==p&&F&&Y(!1),U(s),R(e)},onPrimaryButtonClick:e=>{M!==m&&M!==p&&M!==y||(C("create_passkey_started",{subform_name:M===y?"passkey_info":"passkey_main"}),se(),D(!0)),M===x&&(C("create_passkey_continue_trading"),E.push(r.routes.traders_hub)),M===j&&X(G.id,e?.name??G.name),M===k&&R(W?.length?p:m)},onSecondaryButtonClick:()=>{M!==m&&M!==p||(C("info_open"),R(y)),M!==y&&M!==h||(C("info_back"),R(W?.length?p:m)),M===x&&(C("add_more_passkeys"),R(p)),M===j&&(C("passkey_rename_back"),R(p))},passkey_status:M,passkeys_list:W||[]}),F&&(0,L.jsx)("div",{className:"passkeys-snackbar__container",children:(0,L.jsx)(o.InlineMessage,{size:"sm",message:(0,L.jsx)(d.Localize,{i18n_default_text:"Changes saved."}),type:"information"})}),(0,L.jsx)(S,{is_modal_open:A,onButtonClick:()=>{ee(),ie||C("create_passkey_reminder_passed"),D(!1)},toggleModal:()=>{D(!1)}}),(0,L.jsx)(b,{error:ie,is_modal_open:O,onButtonClick:()=>{E.push(r.routes.traders_hub)}}),(0,L.jsx)(P,{is_modal_open:M===h&&!O,onSecondaryButtonClick:()=>{R(W?.length?p:m)},onPrimaryButtonClick:()=>{J(G?.id)}})]}):(0,L.jsx)(i.Redirect,{to:r.routes.traders_hub})}))}}]);