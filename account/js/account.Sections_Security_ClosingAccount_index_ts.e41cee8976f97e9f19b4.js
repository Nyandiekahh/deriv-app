"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_ClosingAccount_index_ts"],{"./Sections/Security/ClosingAccount/index.ts":(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var s=a("react"),n=a("react-router-dom"),o=a("@deriv/stores"),c=a("@deriv-com/translations"),i=a("@deriv/components"),r=a("../../../node_modules/react/jsx-runtime.js");const l=({redirectToReasons:e})=>(0,r.jsx)(i.Button,{className:"closing-account__button--close-account",large:!0,onClick:()=>e(),primary:!0,children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close my account"})}),d=(0,o.observer)((({redirectToReasons:e})=>{const{common:t}=(0,o.useStore)(),{is_from_derivgo:a}=t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"closing-account__information",children:(0,r.jsx)(i.Text,{size:"xs",weight:"bold",className:"closing-account__information--bold",as:"p",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Are you sure?"})})}),(0,r.jsxs)("div",{className:"closing-account__steps",children:[(0,r.jsx)(i.Text,{size:"xs",as:"p",className:"closing-account__title",children:(0,r.jsx)(c.Localize,{i18n_default_text:"If you close your account:"})}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"You can't trade on Deriv."})}),(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"You can't make transactions."})})]})]}),(0,r.jsxs)("div",{className:"closing-account__steps",children:[(0,r.jsx)(i.Text,{size:"xs",as:"p",line_height:"s",className:"closing-account__title",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Before closing your account:"})}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close all your positions."})}),(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"Withdraw your funds."})})]})]}),(0,r.jsx)("div",{className:"closing-account__steps",children:(0,r.jsx)(i.Text,{size:"xs",as:"p",line_height:"s",children:(0,r.jsx)(c.Localize,{i18n_default_text:"We shall delete your personal information as soon as our legal obligations are met, as mentioned in the section on Data Retention in our <0>Security and privacy policy</0>",components:[(0,r.jsx)(i.StaticUrl,{className:"link",href:"tnc/security-and-privacy.pdf",is_document:!0},0)]})})}),a?(0,r.jsx)("div",{className:"closing-account__buttons-container",children:(0,r.jsx)(l,{redirectToReasons:e})}):(0,r.jsxs)("div",{className:"closing-account__buttons-container",children:[(0,r.jsx)(n.Link,{to:"/",children:(0,r.jsx)(i.Button,{className:"closing-account__button--cancel",large:!0,secondary:!0,children:(0,r.jsx)(c.Localize,{i18n_default_text:"Cancel"})})}),(0,r.jsx)(l,{redirectToReasons:e})]})]})}));var _=a("@deriv/shared"),u=a("@deriv/api");const m=110,x="SET_CHECKBOX_DISABLED",p="SET_TOTAL_CHECKBOX_CHECKED",h="SET_REMAINING_CHARACTERS",g="SET_TOTAL_ACCUMULATED_CHARACTERS";var f=a("@deriv-com/utils");const j=({currency_icon:e,loginid:t,title:a,value:s})=>(0,r.jsxs)("div",{className:"closing-account-error__container",children:[(0,r.jsxs)("div",{className:"closing-account-error__account-details",children:[(0,r.jsx)(i.Icon,{icon:e,size:24}),(0,r.jsxs)("div",{className:"closing-account-error__account",children:[(0,r.jsx)(i.Text,{line_height:"s",color:"prominent",size:"xs",children:a}),(0,r.jsx)(i.Text,{color:"prominent",size:"xxxs",line_height:"xs",children:t})]})]}),(0,r.jsx)(i.Text,{className:"closing-account-error__details",color:"prominent",size:"xs",line_height:"s",align:"right",children:s})]}),y=({children:e,title:t,description:a})=>(0,r.jsxs)("div",{className:"closing-account-error",children:[(0,r.jsx)(i.Text,{as:"p",line_height:"s",size:"xs",weight:"bold",color:"prominent",className:"closing-account-error__title",children:t}),a&&(0,r.jsx)(i.Text,{as:"p",size:"xxs",className:"closing-account-error__description",children:a}),(0,r.jsx)("div",{className:"closing-account-error__wrapper",children:e})]}),b=(0,o.observer)((({platform:e,account_balance:t})=>{const{traders_hub:a}=(0,o.useStore)(),{is_eu_user:s}=a,n=e===_.CFD_PLATFORMS.MT5;return(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please withdraw your funds from the following {{platform_name}} account(s):",values:{platform_name:(0,_.getCFDPlatformLabel)(e)}}),children:t.map((t=>(0,r.jsx)(j,{currency_icon:(e=>{switch(e){case _.CFD_PLATFORMS.MT5:return`IcMt5-${(0,_.getMT5Icon)({market_type:t.market_type,is_eu:s,product:t.product})}`;case _.CFD_PLATFORMS.DXTRADE:return`IcDxtrade-${(0,_.getCFDAccount)({market_type:t.market_type,sub_account_type:t.sub_account_type,platform:e,is_eu:s})}`;case _.CFD_PLATFORMS.CTRADER:return"IcCtrader";default:return""}})(e),loginid:t.display_login,title:(0,_.getCFDAccountDisplay)({market_type:t.market_type,sub_account_type:t.sub_account_type,platform:e,shortcode:n?t.landing_company_short:void 0,is_eu:s,product:t.product})??"",value:t.currency&&(0,r.jsx)(i.Money,{currency:t.currency,amount:f.FormatUtils.formatMoney(t.balance??0,{currency:t.currency}),should_format:!1})},t.login)))})})),v=(0,o.observer)((({platform:e,open_positions:t})=>{const{traders_hub:a}=(0,o.useStore)(),{is_eu_user:s}=a,n=e===_.CFD_PLATFORMS.MT5;return(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please close your positions in the following {{platform_name}} account(s):",values:{platform_name:(0,_.getCFDPlatformLabel)(e)}}),children:t.map((t=>(0,r.jsx)(j,{currency_icon:(e=>{switch(e){case _.CFD_PLATFORMS.MT5:return`IcMt5-${(0,_.getMT5Icon)({market_type:t.market_type,is_eu:s,product:t.product})}`;case _.CFD_PLATFORMS.DXTRADE:return`IcDxtrade-${(0,_.getCFDAccount)({market_type:t.market_type,sub_account_type:t.sub_account_type,platform:e,is_eu:s})}`;case _.CFD_PLATFORMS.CTRADER:return"IcCtrader";default:return""}})(e),loginid:t.display_login,title:(0,_.getCFDAccountDisplay)({market_type:t.market_type,sub_account_type:t.sub_account_type,platform:e,shortcode:n?t.landing_company_short:void 0,is_eu:s,product:t.product})??"",value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{number_of_positions}} position(s)",values:{number_of_positions:t.positions}})},t.login)))})})),C=(e,t)=>e.find((e=>e.loginid===t)),T=(e,t)=>e.find((e=>e.login===t)),w=(e,t)=>e.find((e=>e.account_id===t)),L=(0,o.observer)((({details:e,onConfirm:t})=>{const{client:a}=(0,o.useStore)(),{dxtrade_accounts_list:n,mt5_login_list:l,account_list:d,ctrader_accounts_list:u}=a;let m=[],x=[],p=[],h=[],g=[],L=[],z=[],k=[],D=[];return e?.pending_withdrawals&&Object.keys(e.pending_withdrawals).forEach((t=>{const a={withdrawals:e.pending_withdrawals?.[t]},s=C(d,t);s&&(p=[...p,{...s,...a}])})),e?.open_positions&&Object.keys(e.open_positions).forEach((t=>{const a={positions:e.open_positions?.[t]},s=C(d,t);if(s)m=[...m,{...s,...a}];else{const e=T(l,t);e&&(h=[...h,{...e,...a}]);const s=w(n,t);s&&(L=[...L,{...s,...a}]);const o=w(u,t);o&&(k=[...k,{...o,...a}])}})),e?.balance&&Object.keys(e.balance).forEach((t=>{const a={balance:e.balance?.[t].balance,currency:e.balance?.[t].currency},s=C(d,t);if(s)x=[...x,{...s,...a}];else{const e=T(l,t);e&&(g=[...g,{...e,...a}]);const s=w(n,t);s&&(z=[...z,{...s,...a}]);const o=w(u,t);o&&(D=[...D,{...o,...a}])}})),(0,r.jsxs)(s.Fragment,{children:[(0,r.jsxs)(i.ThemedScrollbars,{autohide:!1,width:"43rem",children:[!!m.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please close your positions in the following Deriv account(s):"}),children:m.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{number_of_positions}} position(s)",values:{number_of_positions:e.positions}})},e.loginid)))}),!!x.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please withdraw your funds from the following Deriv account(s):"}),children:x.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:e.currency&&(0,r.jsx)(i.Money,{currency:e.currency,amount:f.FormatUtils.formatMoney(e.balance??0,{currency:e.currency}),should_format:!1})},e.loginid)))}),!!h.length&&(0,r.jsx)(v,{platform:_.CFD_PLATFORMS.MT5,open_positions:h}),!!g.length&&(0,r.jsx)(b,{platform:_.CFD_PLATFORMS.MT5,account_balance:g}),!!L.length&&(0,r.jsx)(v,{platform:_.CFD_PLATFORMS.DXTRADE,open_positions:L}),!!z.length&&(0,r.jsx)(b,{platform:_.CFD_PLATFORMS.DXTRADE,account_balance:z}),!!k.length&&(0,r.jsx)(v,{platform:_.CFD_PLATFORMS.CTRADER,open_positions:k}),!!D.length&&(0,r.jsx)(b,{platform:_.CFD_PLATFORMS.CTRADER,account_balance:D}),!!p.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Pending withdrawal request:"}),description:(0,r.jsx)(c.Localize,{i18n_default_text:"We are still processing your withdrawal request.<0 />Please wait for the transaction to be completed before deactivating your account.",components:[(0,r.jsx)("br",{},0)]}),children:p.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{pending_withdrawals}} pending withdrawal(s)",values:{pending_withdrawals:e.withdrawals}})},e.loginid)))})]}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Button,{className:"closing-account-error__button",primary:!0,onClick:t,children:(0,r.jsx)(c.Localize,{i18n_default_text:"OK"})})})]})}));var z=a("formik");const k={"financial-priorities":!1,"stop-trading":!1,"not-interested":!1,"another-website":!1,"not-user-friendly":!1,"difficult-transactions":!1,"lack-of-features":!1,"unsatisfactory-service":!1,"other-reasons":!1,other_trading_platforms:"",do_to_improve:""},D={is_checkbox_disabled:!1,total_checkbox_checked:0,remaining_characters:m,total_accumulated_characters:0},F=(e,t)=>{switch(t.type){case x:return{...e,is_checkbox_disabled:t.payload};case p:return{...e,total_checkbox_checked:t.payload};case h:return{...e,remaining_characters:t.payload};case g:return{...e,total_accumulated_characters:t.payload};default:return e}},A=({onBackClick:e,onConfirmClick:t})=>{const[a,n]=(0,s.useReducer)(F,D),{localize:o}=(0,c.useTranslations)(),{is_checkbox_disabled:l,total_checkbox_checked:d,remaining_characters:_,total_accumulated_characters:u}=a;(0,s.useEffect)((()=>{3===d?n({type:x,payload:!0}):l&&n({type:x,payload:!1})}),[d,l]);const f=(e,t,a)=>{const s=e.target.value,n=t.length>s.length;(_<=0||u>=m)&&!n?e.preventDefault():a(e)},j=async e=>{const t=e.clipboardData.getData("text")||await navigator.clipboard.readText();(_<=0||t.length>_)&&e.preventDefault()},y=e=>{let t=b(e).map((e=>e[0])).toString();const a=!!e.other_trading_platforms.length,s=!!e.do_to_improve.length;return a&&(t=`${t}, ${e.other_trading_platforms}`),s&&(t=`${t}, ${e.do_to_improve}`),t.replace(/(\r\n|\n|\r)/gm," ")},b=e=>Object.entries(e).filter((([e,t])=>!["other_trading_platforms","do_to_improve"].includes(e)&&t));return(0,r.jsx)(z.Formik,{initialValues:k,validate:e=>{const t={},a=b(e).length,s=(e.other_trading_platforms+e.do_to_improve).length;let c=m-s;if(a){const a=y(e);c=c>=0?c:0,/^[a-zA-Z0-9.,'\-\s]*$/.test(a)||(t.characters_limits=o("Must be numbers, letters, and special characters . , ' -"))}else t.empty_reason=o("Please select at least one reason");return n({type:g,payload:s}),n({type:h,payload:c}),t},onSubmit:e=>{const a=y(e);t(a)},children:({values:t,setFieldValue:a,errors:s,handleChange:u,dirty:x,isValid:h})=>(0,r.jsxs)(z.Form,{children:[[{name:"financial-priorities",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I have other financial priorities."})},{name:"stop-trading",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I want to stop myself from trading."})},{name:"not-interested",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I’m no longer interested in trading."})},{name:"another-website",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I prefer another trading website."})},{name:"not-user-friendly",label:(0,r.jsx)(c.Localize,{i18n_default_text:"The platforms aren’t user-friendly."})},{name:"difficult-transactions",label:(0,r.jsx)(c.Localize,{i18n_default_text:"Making deposits and withdrawals is difficult."})},{name:"lack-of-features",label:(0,r.jsx)(c.Localize,{i18n_default_text:"The platforms lack key features or functionality."})},{name:"unsatisfactory-service",label:(0,r.jsx)(c.Localize,{i18n_default_text:"Customer service was unsatisfactory."})},{name:"other-reasons",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I’m closing my account for other reasons."})}].map((e=>(0,r.jsx)(z.Field,{name:e.name,children:({field:s})=>(0,r.jsx)(i.Checkbox,{...s,disabled:l&&!t[s.name],className:"closing-account-reasons__checkbox",label:e.label,onChange:()=>{((e,t,a)=>{e[t]?(n({type:p,payload:d-1}),a(t,!e[t])):(n({type:p,payload:d+1}),a(t,!e[t]))})(t,s.name,a)}})},e.name))),(0,r.jsx)(z.Field,{name:"other_trading_platforms",children:({field:e})=>(0,r.jsx)(i.Input,{...e,className:"closing-account-reasons__input","data-lpignore":"true",autoComplete:"off",type:"textarea",placeholder:o("If you don’t mind sharing, which other trading platforms do you use?"),name:"other_trading_platforms",value:t.other_trading_platforms,max_characters:m,onChange:e=>f(e,t.other_trading_platforms,u),onPaste:j})}),(0,r.jsx)(z.Field,{name:"do_to_improve",children:({field:e})=>(0,r.jsx)(i.Input,{...e,className:"closing-account-reasons__input","data-lpignore":"true",autoComplete:"off",type:"textarea",placeholder:o("What could we do to improve?"),name:"do_to_improve",value:t.do_to_improve,max_characters:m,onChange:e=>f(e,t.do_to_improve,u),onPaste:j})}),(0,r.jsxs)("div",{className:"closing-account-reasons__footer",children:[(0,r.jsxs)("div",{className:"closing-account-reasons__hint-wrapper",children:[(0,r.jsx)(i.Text,{size:"xxs",as:"p",color:"less-prominent",className:"closing-account-reasons__hint",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Remaining characters: {{remaining_characters}}",values:{remaining_characters:_}})}),!h&&Object.entries(s).map((([e,t])=>(0,r.jsx)(i.Text,{as:"p",weight:"bold",size:"xs",color:"loss-danger",className:"closing-account-reasons__error",children:t},e)))]}),(0,r.jsx)(i.FormSubmitButton,{is_disabled:!x||!h,label:o("Continue"),has_cancel:!0,cancel_label:o("Back"),onCancel:e})]})]})})},S=({show_warning_modal:e,startDeactivating:t,closeWarningModal:a})=>{const{localize:s}=(0,c.useTranslations)();return(0,r.jsx)(i.Modal,{className:"closing-account-reasons",is_open:e,toggleModal:a,children:(0,r.jsxs)("div",{className:"account-closure-warning-modal",children:[(0,r.jsx)(i.Icon,{icon:"IcRedWarning",size:96}),(0,r.jsx)(i.Text,{size:"xs",weight:"bold",className:"account-closure-warning-modal__warning-message",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close your account?"})}),(0,r.jsx)("div",{className:"account-closure-warning-modal__content-wrapper",children:(0,r.jsx)(i.Text,{as:"p",align:"center",className:"account-closure-warning-modal__content",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Closing your account will automatically log you out. We shall delete your personal information as soon as our legal obligations are met."})})}),(0,r.jsx)(i.FormSubmitButton,{label:s("Close account"),className:"account-closure-warning-modal__close-account-button",has_cancel:!0,cancel_label:s("Go Back"),onClick:t,onCancel:a})]})})},N=({message:e,onClick:t})=>(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("div",{className:"closing-account-error__container closing-account-error__container-message",children:(0,r.jsx)("div",{className:"closing-account-error__details closing-account-error__details-message",children:(0,r.jsx)(i.Text,{size:"xs",children:e})})}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Button,{className:"closing-account-error__button",primary:!0,onClick:t,children:(0,r.jsx)(c.Localize,{i18n_default_text:"OK"})})})]}),R=({redirectToSteps:e})=>{const{mutate:t,error:a,isSuccess:o,isLoading:l}=(0,u.useCloseDerivAccount)(),[d,m]=(0,s.useState)(""),[x,p]=(0,s.useState)(""),[h,g]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(a&&"object"==typeof a&&"code"in a){const{code:e}=a;p("AccountHasPendingConditions"===e?"account_has_pending_conditions_modal":"MT5AccountInaccessible"===e?"inaccessible_modal":"error_modal")}}),[a]);const f=()=>{p("")},j=()=>{g(!1)};return o?(0,r.jsx)(n.Redirect,{to:_.routes.account_closed}):l?(0,r.jsx)(i.Loading,{is_fullscreen:!1}):(0,r.jsxs)("div",{className:"closing-account-reasons",children:[(0,r.jsx)(i.Text,{weight:"bold",size:"xs",className:"closing-account-reasons__title",as:"p",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Please tell us why you’re leaving. (Select up to {{ allowed_reasons }} reasons.)",values:{allowed_reasons:3}})}),(0,r.jsx)(A,{onBackClick:e,onConfirmClick:e=>{g(!0),m(e)}}),h&&(0,r.jsx)(S,{show_warning_modal:h,closeWarningModal:j,startDeactivating:async()=>{j(),t({payload:{reason:d}})}}),(0,r.jsx)(i.Modal,{className:"closing-account-reasons",is_open:!!x,toggleModal:f,title:(()=>{if(!x)return"";switch(x){case"error_modal":return(0,r.jsx)(c.Localize,{i18n_default_text:"An error occurred"});case"inaccessible_modal":return(0,r.jsx)(c.Localize,{i18n_default_text:"Inaccessible MT5 account(s)"});default:return(0,r.jsx)(c.Localize,{i18n_default_text:"Action required"})}})(),children:(()=>{switch(x){case"account_has_pending_conditions_modal":return(0,r.jsx)(L,{details:a&&"object"==typeof a&&"details"in a&&"object"==typeof a.details?a.details:{},onConfirm:e});case"inaccessible_modal":return(0,r.jsx)(N,{message:a&&"object"==typeof a&&"message"in a&&"string"==typeof a.message?a.message:"",onClick:f});default:return null}})()})]})},M=()=>{const[e,t]=(0,s.useState)(!1);return(0,r.jsx)("div",{className:"closing-account","data-testid":"dt_closing_account",children:e?(0,r.jsx)(R,{redirectToSteps:()=>{t(!1)}}):(0,r.jsx)(d,{redirectToReasons:()=>{t(!0)}})})}}}]);